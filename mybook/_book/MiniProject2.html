<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Mike K Smith">
<meta name="dcterms.date" content="2023-02-13">

<title>2&nbsp; Mini-project 2 - Summarising continuous and categorical data – Pharma Hands-on Exercises</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./MiniProject4.html" rel="next">
<link href="./MiniProject1.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-cd63b520c5e060288b5099369e8bcbf0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./MiniProject2.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Mini-project 2 - Summarising continuous and categorical data</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Pharma Hands-on Exercises</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Abstract</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MiniProject1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Mini-project 1 - Reading and exploring datasets</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MiniProject2.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Mini-project 2 - Summarising continuous and categorical data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MiniProject4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Mini-project 4 - Creating summary table data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MiniProject5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Mini-project 5 - Getting started with {ggplot2}</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MiniProject6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Mini-project 6 - {ggplot2} extensions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MiniProject7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Mini-project 7 - Getting started writing functions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MiniProject8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Mini-project 8 - Applying functions through iteration</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MiniProject9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Mini-project 9 - Reproducible examples and {reprex}</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MiniProject10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Mini-project 10 - Debugging</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MiniProject12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Mini-project 12 - Testing</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MiniProject13.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Mini-project13 - Code style</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MiniProject14.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Mini-project 14 - R snippets</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#build-familiarity-with-r-coding-generate-counts-and-percentages-of-categorical-variables-by-gender" id="toc-build-familiarity-with-r-coding-generate-counts-and-percentages-of-categorical-variables-by-gender" class="nav-link active" data-scroll-target="#build-familiarity-with-r-coding-generate-counts-and-percentages-of-categorical-variables-by-gender"><span class="header-section-number">3</span> Build familiarity with R coding &amp; generate Counts and Percentages of categorical variables by Gender</a>
  <ul class="collapse">
  <li><a href="#aims" id="toc-aims" class="nav-link" data-scroll-target="#aims"><span class="header-section-number">3.1</span> Aims:</a></li>
  <li><a href="#how-to-use-this-document" id="toc-how-to-use-this-document" class="nav-link" data-scroll-target="#how-to-use-this-document"><span class="header-section-number">3.2</span> How to use this document:</a></li>
  <li><a href="#data-source" id="toc-data-source" class="nav-link" data-scroll-target="#data-source"><span class="header-section-number">3.3</span> Data Source</a></li>
  <li><a href="#r-objects-and-functions" id="toc-r-objects-and-functions" class="nav-link" data-scroll-target="#r-objects-and-functions"><span class="header-section-number">3.4</span> R objects and functions</a></li>
  <li><a href="#start-the-mini-project" id="toc-start-the-mini-project" class="nav-link" data-scroll-target="#start-the-mini-project"><span class="header-section-number">3.5</span> Start the mini project</a></li>
  <li><a href="#challenge-1-you-need-to-complete-this-challenge-to-be-able-to-create-the-final-demog-table." id="toc-challenge-1-you-need-to-complete-this-challenge-to-be-able-to-create-the-final-demog-table." class="nav-link" data-scroll-target="#challenge-1-you-need-to-complete-this-challenge-to-be-able-to-create-the-final-demog-table."><span class="header-section-number">3.6</span> Challenge 1: You need to complete this challenge to be able to create the final demog table.</a></li>
  <li><a href="#challenge-2" id="toc-challenge-2" class="nav-link" data-scroll-target="#challenge-2"><span class="header-section-number">3.7</span> Challenge 2:</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Mini-project 2 - Summarising continuous and categorical data</span></h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Mike K Smith </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 13, 2023</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="build-familiarity-with-r-coding-generate-counts-and-percentages-of-categorical-variables-by-gender" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Build familiarity with R coding &amp; generate Counts and Percentages of categorical variables by Gender</h1>
<p>In this project we are working towards creating a demography summary table like this one: <img src="img/MiniProject2_demog_table.png" class="img-fluid" alt="Demographic table"></p>
<p>Ours won’t look exactly like this, but we will be trying to mimic the structure of this table.</p>
<section id="aims" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="aims"><span class="header-section-number">3.1</span> Aims:</h2>
<ul>
<li>Read in ADSL SAS (xpt) dataset</li>
<li>Subset for Efficacy Analysis Population</li>
<li>Count observations within grouping variables and calculate percentages of total N</li>
<li>Transpose the resulting data to prepare for tabulation</li>
</ul>
</section>
<section id="how-to-use-this-document" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="how-to-use-this-document"><span class="header-section-number">3.2</span> How to use this document:</h2>
<p>In this document you’ll see code chunks (typically on a light grey background) and text. This is an example of an “Rmarkdown” document. You can write and run code within the document and the results will be presented underneath each code chunk. You should follow the instructions as written in the text, amending the code chunks, then running them to produce the outputs as instructed.</p>
</section>
<section id="data-source" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="data-source"><span class="header-section-number">3.3</span> Data Source</h2>
<p>For these projects we are using anonymized CDISC datasets, which can be found here: https://github.com/phuse-org/phuse-scripts/tree/master/data/adam/cdisc</p>
</section>
<section id="r-objects-and-functions" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="r-objects-and-functions"><span class="header-section-number">3.4</span> R objects and functions</h2>
<p>Within R we typically use objects of different types e.g.&nbsp;data, vectors, lists etc. and then we apply functions. Functions have the construct <code>&lt;function_name&gt;(&lt;argument1&gt;=   , &lt;argument2&gt; = )</code>. When you use functions, you don’t <strong><em>have</em></strong> to use the argument name and instead you can implicitly refer to the arguments by position e.g.&nbsp;<code>myFunction(foo, 1, "bar")</code> passes in the R object <code>foo</code> as the value for argument 1; argument 2 takes the value <code>1</code> and argument 3 takes the character value <code>"bar"</code>. While you’re learning R we recommend that you explicitly name and use the arguments in functions, except where functions only have one argument. You can use the tab-completion in the RStudio IDE to help complete function call arguments. To see the arguments of a function type <code>?&lt;functionName&gt;</code> in the Console.</p>
</section>
<section id="start-the-mini-project" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="start-the-mini-project"><span class="header-section-number">3.5</span> Start the mini project</h2>
<ol type="1">
<li>The following steps will load the packages <code>tidyverse</code>, <code>rio</code>, <code>skimr</code> and <code>htmlTable</code>. You need to load packages before using the functions and content in them, and it’s best to do so at the beginning of a program / script. Run the chunk below by clicking on the green arrow to the right of the code chunk.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.2     ✔ tibble    3.3.0
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.0.4     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rio)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Read in the CDISC adsl data from the GitHub location (<code>https://github.com/phuse-org/phuse-scripts/raw/master/data/adam/cdisc/adsl.xpt</code>) and assign this to an object in R using the assignment operator <code>&lt;-</code>. Make sure that the URL location is a character string by enclosing it in <code>" "</code>. The <code>rio</code> package has a function called <code>import</code> that reads data into R and infers the data type from the file name. The first argument of that function is <code>file</code>. Paste the file path / URL above after the <code>file=</code> argument in the code below, then run the chunk using the green arrow.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>adsl <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="at">file =</span> <span class="st">"./data/adsl.xpt"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(adsl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       STUDYID     USUBJID SUBJID SITEID SITEGR1                  ARM
1 CDISCPILOT01 01-701-1015   1015    701     701              Placebo
2 CDISCPILOT01 01-701-1023   1023    701     701              Placebo
3 CDISCPILOT01 01-701-1028   1028    701     701 Xanomeline High Dose
4 CDISCPILOT01 01-701-1033   1033    701     701  Xanomeline Low Dose
5 CDISCPILOT01 01-701-1034   1034    701     701 Xanomeline High Dose
6 CDISCPILOT01 01-701-1047   1047    701     701              Placebo
                TRT01P TRT01PN               TRT01A TRT01AN     TRTSDT
1              Placebo       0              Placebo       0 2014-01-02
2              Placebo       0              Placebo       0 2012-08-05
3 Xanomeline High Dose      81 Xanomeline High Dose      81 2013-07-19
4  Xanomeline Low Dose      54  Xanomeline Low Dose      54 2014-03-18
5 Xanomeline High Dose      81 Xanomeline High Dose      81 2014-07-01
6              Placebo       0              Placebo       0 2013-02-12
      TRTEDT TRTDUR AVGDD CUMDOSE AGE AGEGR1 AGEGR1N  AGEU  RACE RACEN SEX
1 2014-07-02    182   0.0       0  63    &lt;65       1 YEARS WHITE     1   F
2 2012-09-01     28   0.0       0  64    &lt;65       1 YEARS WHITE     1   M
3 2014-01-14    180  77.7   13986  71  65-80       2 YEARS WHITE     1   M
4 2014-03-31     14  54.0     756  74  65-80       2 YEARS WHITE     1   M
5 2014-12-30    183  76.9   14067  77  65-80       2 YEARS WHITE     1   F
6 2013-03-09     26   0.0       0  85    &gt;80       3 YEARS WHITE     1   F
                  ETHNIC SAFFL ITTFL EFFFL COMP8FL COMP16FL COMP24FL DISCONFL
1     HISPANIC OR LATINO     Y     Y     Y       Y        Y        Y         
2     HISPANIC OR LATINO     Y     Y     Y       N        N        N        Y
3 NOT HISPANIC OR LATINO     Y     Y     Y       Y        Y        Y         
4 NOT HISPANIC OR LATINO     Y     Y     Y       N        N        N        Y
5 NOT HISPANIC OR LATINO     Y     Y     Y       Y        Y        Y         
6 NOT HISPANIC OR LATINO     Y     Y     Y       N        N        N        Y
  DSRAEFL DTHFL BMIBL BMIBLGR1 HEIGHTBL WEIGHTBL EDUCLVL   DISONSDT DURDIS
1                25.1   25-&lt;30    147.3     54.4      16 2010-04-30   43.9
2       Y        30.4     &gt;=30    162.6     80.3      14 2006-03-11   76.4
3                31.4     &gt;=30    177.8     99.3      16 2009-12-16   42.8
4                28.8   25-&lt;30    175.3     88.5      12 2009-08-02   55.3
5                26.1   25-&lt;30    154.9     62.6       9 2011-09-29   32.9
6       Y        30.4     &gt;=30    148.6     67.1       8 2009-07-26   42.0
  DURDSGR1   VISIT1DT    RFSTDTC    RFENDTC VISNUMEN     RFENDT
1     &gt;=12 2013-12-26 2014-01-02 2014-07-02       12 2014-07-02
2     &gt;=12 2012-07-22 2012-08-05 2012-09-02        5 2012-09-02
3     &gt;=12 2013-07-11 2013-07-19 2014-01-14       12 2014-01-14
4     &gt;=12 2014-03-10 2014-03-18 2014-04-14        5 2014-04-14
5     &gt;=12 2014-06-24 2014-07-01 2014-12-30       12 2014-12-30
6     &gt;=12 2013-01-22 2013-02-12 2013-03-29        6 2013-03-29
                      DCDECOD         DCREASCD MMSETOT
1                   COMPLETED        Completed      23
2               ADVERSE EVENT    Adverse Event      23
3                   COMPLETED        Completed      23
4 STUDY TERMINATED BY SPONSOR Sponsor Decision      23
5                   COMPLETED        Completed      21
6               ADVERSE EVENT    Adverse Event      23</code></pre>
</div>
</div>
<p>Note that the <code>adsl</code> data object has 254 rows and 48 columns.</p>
<p>Now create a new data object <code>adsl_eff</code> for Efficacy Analysis population. We need to filter the <code>adsl</code> data object where the variable <code>EFFFL</code> has the value <code>Y</code>. Answer the question below and paste the correct answer into the code chunk.</p>
<hr>
<p>QUICK QUIZ: Which of the following options will filter the data where the variable EFFFL has the value <code>Y</code>?</p>
<ul>
<li>filter(.data = adsl, EFFFL = Y)</li>
<li>filter(.data = adsl, EFFFL == “Y”)</li>
<li>filter(.data = adsl, “EFFFL” == “Y”)</li>
<li>filter(.data = adsl, EFFFL = “y”)</li>
</ul>
<p>(HINT: We also did this task in MiniProject 1)</p>
<p>If you are unsure, try each option by pasting in the filter statement after the assignment <code>&lt;-</code> in the code chunk below.</p>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>adsl_eff <span class="ot">&lt;-</span> adsl <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(EFFFL <span class="sc">==</span> <span class="st">"Y"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(adsl_eff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       STUDYID     USUBJID SUBJID SITEID SITEGR1                  ARM
1 CDISCPILOT01 01-701-1015   1015    701     701              Placebo
2 CDISCPILOT01 01-701-1023   1023    701     701              Placebo
3 CDISCPILOT01 01-701-1028   1028    701     701 Xanomeline High Dose
4 CDISCPILOT01 01-701-1033   1033    701     701  Xanomeline Low Dose
5 CDISCPILOT01 01-701-1034   1034    701     701 Xanomeline High Dose
6 CDISCPILOT01 01-701-1047   1047    701     701              Placebo
                TRT01P TRT01PN               TRT01A TRT01AN     TRTSDT
1              Placebo       0              Placebo       0 2014-01-02
2              Placebo       0              Placebo       0 2012-08-05
3 Xanomeline High Dose      81 Xanomeline High Dose      81 2013-07-19
4  Xanomeline Low Dose      54  Xanomeline Low Dose      54 2014-03-18
5 Xanomeline High Dose      81 Xanomeline High Dose      81 2014-07-01
6              Placebo       0              Placebo       0 2013-02-12
      TRTEDT TRTDUR AVGDD CUMDOSE AGE AGEGR1 AGEGR1N  AGEU  RACE RACEN SEX
1 2014-07-02    182   0.0       0  63    &lt;65       1 YEARS WHITE     1   F
2 2012-09-01     28   0.0       0  64    &lt;65       1 YEARS WHITE     1   M
3 2014-01-14    180  77.7   13986  71  65-80       2 YEARS WHITE     1   M
4 2014-03-31     14  54.0     756  74  65-80       2 YEARS WHITE     1   M
5 2014-12-30    183  76.9   14067  77  65-80       2 YEARS WHITE     1   F
6 2013-03-09     26   0.0       0  85    &gt;80       3 YEARS WHITE     1   F
                  ETHNIC SAFFL ITTFL EFFFL COMP8FL COMP16FL COMP24FL DISCONFL
1     HISPANIC OR LATINO     Y     Y     Y       Y        Y        Y         
2     HISPANIC OR LATINO     Y     Y     Y       N        N        N        Y
3 NOT HISPANIC OR LATINO     Y     Y     Y       Y        Y        Y         
4 NOT HISPANIC OR LATINO     Y     Y     Y       N        N        N        Y
5 NOT HISPANIC OR LATINO     Y     Y     Y       Y        Y        Y         
6 NOT HISPANIC OR LATINO     Y     Y     Y       N        N        N        Y
  DSRAEFL DTHFL BMIBL BMIBLGR1 HEIGHTBL WEIGHTBL EDUCLVL   DISONSDT DURDIS
1                25.1   25-&lt;30    147.3     54.4      16 2010-04-30   43.9
2       Y        30.4     &gt;=30    162.6     80.3      14 2006-03-11   76.4
3                31.4     &gt;=30    177.8     99.3      16 2009-12-16   42.8
4                28.8   25-&lt;30    175.3     88.5      12 2009-08-02   55.3
5                26.1   25-&lt;30    154.9     62.6       9 2011-09-29   32.9
6       Y        30.4     &gt;=30    148.6     67.1       8 2009-07-26   42.0
  DURDSGR1   VISIT1DT    RFSTDTC    RFENDTC VISNUMEN     RFENDT
1     &gt;=12 2013-12-26 2014-01-02 2014-07-02       12 2014-07-02
2     &gt;=12 2012-07-22 2012-08-05 2012-09-02        5 2012-09-02
3     &gt;=12 2013-07-11 2013-07-19 2014-01-14       12 2014-01-14
4     &gt;=12 2014-03-10 2014-03-18 2014-04-14        5 2014-04-14
5     &gt;=12 2014-06-24 2014-07-01 2014-12-30       12 2014-12-30
6     &gt;=12 2013-01-22 2013-02-12 2013-03-29        6 2013-03-29
                      DCDECOD         DCREASCD MMSETOT
1                   COMPLETED        Completed      23
2               ADVERSE EVENT    Adverse Event      23
3                   COMPLETED        Completed      23
4 STUDY TERMINATED BY SPONSOR Sponsor Decision      23
5                   COMPLETED        Completed      21
6               ADVERSE EVENT    Adverse Event      23</code></pre>
</div>
</div>
<p>After filtering out the data we now have 234 rows and 48 columns.</p>
<p>Again, recall that R is case-sensitive. Most variable names in SAS datasets are uppercase, so we need to ensure that the variable name is UPPERCASE i.e.&nbsp;<code>EFFFL</code> and not <code>Efffl</code> etc. Also, since the value is character, we need to ensure that the case of the equivalent value matches the expected result i.e.&nbsp;<code>Y</code> and not <code>y</code> or <code>Yes</code> and that it is enclosed in quotes <code>" "</code>.</p>
<p>DEFENSIVE PROGRAMMING in R: If you’re dealing with data where you can’t guarantee that the value is upper case or lower case, then it’s a good idea to convert the values to uppercase before you compare using the <code>casefold()</code> function wrapped around the variable name i.e.&nbsp;<code>casefold(EFFFL, upper=TRUE) == "Y"</code></p>
<ol start="3" type="1">
<li>Calculate the marginal totals (N) - count the number of individuals in each treatment group.</li>
</ol>
<p>Next we need to count and save the marginal totals (big N) to act as the denominator for the calculation of the percentage of observations in each table cell = n/N * 100%</p>
<p>In the R chunk below, we start with the <code>adsl_eff</code> dataset and count the number of observations in each level of the variables specified in the <code>group_by()</code> function.</p>
<blockquote class="blockquote">
<p><strong><em>R for SAS users:</em></strong> The <code>group_by()</code> function works a lot like a <code>BY ;</code> statement in SAS. Everything you do after a <code>group_by()</code> will be done for <strong><em>each level</em></strong> of the variables within the <code>group_by()</code>.</p>
</blockquote>
<p>In the next code chunk we want to calculate the number of observations within each level of the treatment variable <code>TRT01A</code>. The {dplyr} package has a function called <code>count()</code> that will do just that. Add the treatment variable <code>TRT01A</code> to the <code>group_by()</code> function in the code below to calculate the number of observations for each treatment group.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>adsl_eff <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(TRT01A) <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(<span class="at">name =</span> <span class="st">"N"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
# Groups:   TRT01A [3]
  TRT01A                   N
  &lt;chr&gt;                &lt;int&gt;
1 Placebo                 79
2 Xanomeline High Dose    74
3 Xanomeline Low Dose     81</code></pre>
</div>
</div>
<p>What happens if you comment out the group_by() statement in the code above? (HINT: Comment out code using <code>#</code> at the start of the line to be commented, or place the cursor on the line / highlight the line and use the shortcut CTRL+SHIFT+C).</p>
<p>Whenever you use <code>group_by()</code> R will carry along the grouping variables into the output. In this example, it’s useful to have both the numeric value for the treatment in period 1 <code>TRT01AN</code> <strong><em>and</em></strong> the label <code>TRT01A</code>. This is because we will want to use the numeric value for sorting, and the label for printing in the final table. Notice in this case since there is a 1:1 relationship between <code>TRT01AN</code> and <code>TRT01A</code> we get the same answer as before.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>Big_N_cnt <span class="ot">&lt;-</span> adsl_eff <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(TRT01AN, TRT01A) <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(<span class="at">name =</span> <span class="st">"N"</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Big_N_cnt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
# Groups:   TRT01AN, TRT01A [3]
  TRT01AN TRT01A                   N
    &lt;dbl&gt; &lt;chr&gt;                &lt;int&gt;
1       0 Placebo                 79
2      54 Xanomeline Low Dose     81
3      81 Xanomeline High Dose    74</code></pre>
</div>
</div>
<ol start="4" type="1">
<li><p>Next we want to calculate the “small n” counts within each category of the <code>SEX</code> variable <strong><em>within</em></strong> each treatment arm.</p>
<p>If we add the additional variable into the <code>group_by()</code> then we calculate the count of observations for each unique combination of the levels of those variables. Let’s amend the code above to add the variable <code>SEX</code>.</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>small_n_cnt <span class="ot">&lt;-</span> adsl_eff <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(TRT01AN, TRT01A, SEX) <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(<span class="at">name =</span> <span class="st">"n"</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(small_n_cnt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
# Groups:   TRT01AN, TRT01A, SEX [6]
  TRT01AN TRT01A               SEX       n
    &lt;dbl&gt; &lt;chr&gt;                &lt;chr&gt; &lt;int&gt;
1       0 Placebo              F        46
2       0 Placebo              M        33
3      54 Xanomeline Low Dose  F        47
4      54 Xanomeline Low Dose  M        34
5      81 Xanomeline High Dose F        35
6      81 Xanomeline High Dose M        39</code></pre>
</div>
</div>
<p>Do we get different answers if we use the <code>group_by()</code> variables in a different order?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>adsl_eff <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SEX, TRT01AN, TRT01A) <span class="sc">%&gt;%</span> <span class="co"># Changed the order of variables</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(<span class="at">name =</span> <span class="st">"n"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
# Groups:   SEX, TRT01AN, TRT01A [6]
  SEX   TRT01AN TRT01A                   n
  &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;                &lt;int&gt;
1 F           0 Placebo                 46
2 F          54 Xanomeline Low Dose     47
3 F          81 Xanomeline High Dose    35
4 M           0 Placebo                 33
5 M          54 Xanomeline Low Dose     34
6 M          81 Xanomeline High Dose    39</code></pre>
</div>
</div>
<p>No.&nbsp;But the order of variables in columns in the output is changed.</p>
<ol start="5" type="1">
<li>Merging “Big_N_cnt” and “small_n_cnt” before calculating percentages…</li>
</ol>
<p>The {dplyr} package gives R users “SQL-like” functionality to join or filter two datasets / tables using a variety of methods: <code>left_join</code>, <code>right_join</code>, <code>inner_join</code>, <code>full_join</code>, <code>anti_join</code>, <code>semi_join</code>. (See <a href="https://dplyr.tidyverse.org/articles/two-table.html" class="uri">https://dplyr.tidyverse.org/articles/two-table.html</a> for more details). If you know <code>PROC SQL</code> then this will be quite familiar.</p>
<p>In the next step we’re going to use <code>left_join</code> to combine the left hand dataset - <code>small_n_cnt</code> with the right hand dataset <code>Big_N_cnt</code>. This will ensure that all entries from the left hand dataset are present in the resulting data object. A little bit of care is required to think about which dataset should be on the left, and which on the right…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>adsl_mrg_cnt <span class="ot">&lt;-</span> small_n_cnt <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(Big_N_cnt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(TRT01AN, TRT01A)`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(adsl_mrg_cnt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
# Groups:   TRT01AN, TRT01A, SEX [6]
  TRT01AN TRT01A               SEX       n     N
    &lt;dbl&gt; &lt;chr&gt;                &lt;chr&gt; &lt;int&gt; &lt;int&gt;
1       0 Placebo              F        46    79
2       0 Placebo              M        33    79
3      54 Xanomeline Low Dose  F        47    81
4      54 Xanomeline Low Dose  M        34    81
5      81 Xanomeline High Dose F        35    74
6      81 Xanomeline High Dose M        39    74</code></pre>
</div>
</div>
<p>Notice that rows in <code>Big_N_cnt</code> that have matching <code>TRT01A</code> and <code>TRT01AN</code> are matched to rows in <code>small_n_cnt</code> and repeated if necessary. By default the <code>&lt;&gt;_join</code> functions of {dplyr} will try to match on variable names that exist in both datasets.</p>
<p>If you <em>need</em> to, you can explicitly define which variables to join by, and identify the joining variables in each dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>small_n_cnt <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(Big_N_cnt, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"TRT01A"</span>, <span class="st">"TRT01AN"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
# Groups:   TRT01AN, TRT01A, SEX [6]
  TRT01AN TRT01A               SEX       n     N
    &lt;dbl&gt; &lt;chr&gt;                &lt;chr&gt; &lt;int&gt; &lt;int&gt;
1       0 Placebo              F        46    79
2       0 Placebo              M        33    79
3      54 Xanomeline Low Dose  F        47    81
4      54 Xanomeline Low Dose  M        34    81
5      81 Xanomeline High Dose F        35    74
6      81 Xanomeline High Dose M        39    74</code></pre>
</div>
</div>
<p>For more information on joining data, see this vignette: <a href="https://dplyr.tidyverse.org/articles/two-table.html" class="uri">https://dplyr.tidyverse.org/articles/two-table.html</a></p>
<ol start="6" type="1">
<li>Calculate percentages for treatment group <code>TRT01A</code> split by <code>SEX</code>.</li>
</ol>
<p>For this step, we want to create a new column in the <code>adsl_mrg_cnt</code> dataset containing the percentage of observations (subjects in the trial) from each <code>SEX</code> within each treatment group given by <code>TRT01A</code> or <code>TRT01AN</code>. The {dplyr} package allows us to add a new variable to an existing dataset and determine its values based on existing columns using a function called <code>mutate()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>adsl_mrg_cnt <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc =</span> (n<span class="sc">/</span>N)<span class="sc">*</span><span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
# Groups:   TRT01AN, TRT01A, SEX [6]
  TRT01AN TRT01A               SEX       n     N  perc
    &lt;dbl&gt; &lt;chr&gt;                &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
1       0 Placebo              F        46    79  58.2
2       0 Placebo              M        33    79  41.8
3      54 Xanomeline Low Dose  F        47    81  58.0
4      54 Xanomeline Low Dose  M        34    81  42.0
5      81 Xanomeline High Dose F        35    74  47.3
6      81 Xanomeline High Dose M        39    74  52.7</code></pre>
</div>
</div>
<p>Note that in calculation of <code>perc</code> we don’t need to put quotes around the variables names <code>n</code> and <code>N</code> because within the tidyverse and {dplyr} these variable names are evaluated within the scope of the input data <code>adsl_mrg_cnt</code>.</p>
<ol start="7" type="1">
<li>Round percentages to one decimal place.</li>
</ol>
<p>Notice that in the data above, the first two percentages have many decimal places. We probably want to round these to one decimal place for use in the table. We can use the R function <code>round()</code> to achieve this.</p>
<hr>
<p><strong><em>NOTE</em></strong>: The <code>round()</code> function in R has different defaults to the round function in SAS. You might find this in several places - that default options are different - leading to differences in results. Please be aware of this and investigate whether R function arguments and settings can be matched to SAS options if it’s important to ensure that the results are comparable.</p>
<p>To investigate this, let’s look at a few example values</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">1.1</span>, <span class="fl">1.499</span>, <span class="fl">1.5</span>,<span class="fl">1.9</span>, <span class="fl">2.5</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 1 2 2 2</code></pre>
</div>
</div>
<p>Notice that R rounds 1.5 and 2.5 to the nearest even values. This follows the IEC 60559 standard (see also ‘IEEE 754’). That is, it’s not <strong><em>wrong</em></strong>, it’s just <strong><em>different to SAS.</em></strong> Be aware of this, check the R help for a function using e.g.&nbsp;<code>?round</code> and also check SAS documentation to see how each tool calculates values.</p>
<p>There are also differences between SAS and R in calculation of percentiles / quantiles and how each handles missing data.</p>
<hr>
<p>To round the values for our table, we want to use the <code>round()</code> function within <code>mutate()</code> function that calculates the new variable <code>perc</code> :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>adsl_mrg_cnt <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc =</span> <span class="fu">round</span>((n<span class="sc">/</span>N)<span class="sc">*</span><span class="dv">100</span>, <span class="at">digits=</span><span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
# Groups:   TRT01AN, TRT01A, SEX [6]
  TRT01AN TRT01A               SEX       n     N  perc
    &lt;dbl&gt; &lt;chr&gt;                &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
1       0 Placebo              F        46    79  58.2
2       0 Placebo              M        33    79  41.8
3      54 Xanomeline Low Dose  F        47    81  58  
4      54 Xanomeline Low Dose  M        34    81  42  
5      81 Xanomeline High Dose F        35    74  47.3
6      81 Xanomeline High Dose M        39    74  52.7</code></pre>
</div>
</div>
<ol start="8" type="1">
<li>Formatting numeric values for use in tables.</li>
</ol>
<p>When we use numeric values in tables, we want to ensure that the values in the table will have consistent presentation, so one decimal place is used for both “20.0” and “26.1” (instead of “20.0” becoming “20”). We can easily achieve this by applying print formatting and turning the numeric values into character. In R we use the <code>format()</code> function to achieve this. The <code>format()</code> function argument <code>nsmall</code> defines the minimal number of decimal places to be used. So setting <code>nsmall=1</code> will ensure that all values are formatted to at least 1 decimal place.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>adsl_mrg_cnt <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc =</span> <span class="fu">round</span>((n<span class="sc">/</span>N)<span class="sc">*</span><span class="dv">100</span>, <span class="at">digits=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc_char =</span> <span class="fu">format</span>(perc, <span class="at">nsmall=</span><span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 7
# Groups:   TRT01AN, TRT01A, SEX [6]
  TRT01AN TRT01A               SEX       n     N  perc perc_char
    &lt;dbl&gt; &lt;chr&gt;                &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;    
1       0 Placebo              F        46    79  58.2 58.2     
2       0 Placebo              M        33    79  41.8 41.8     
3      54 Xanomeline Low Dose  F        47    81  58   58.0     
4      54 Xanomeline Low Dose  M        34    81  42   42.0     
5      81 Xanomeline High Dose F        35    74  47.3 47.3     
6      81 Xanomeline High Dose M        39    74  52.7 52.7     </code></pre>
</div>
</div>
<p>Notice in this output that the column <code>perc</code> is of type <code>&lt;dbl&gt;</code> while <code>perc_char</code> is of type <code>&lt;char&gt;</code>. Anything that is is character type in R will not be further formatted and will display “as is” in a table or listing.</p>
<ol start="9" type="1">
<li>Paste together the count and percentage</li>
</ol>
<p>For presentation in the table, we usually want to show both the count and its associated percentage. Now that we have the <code>perc_char</code> character variable, this is easy using R’s <code>paste()</code> and <code>paste0()</code> functions. These two functions work identically in pasting together character strings and variables, but <code>paste()</code> has a default separator of a single space, while <code>paste0()</code> has no separator.</p>
<hr>
<p>Can you predict what you’ll see for each of the code chunks below? Have a think <em>first</em> then run the code to check whether you’re right.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>perc_char <span class="ot">&lt;-</span> <span class="st">"26.1"</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(n, <span class="st">"("</span>,perc_char,<span class="st">")"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "6 ( 26.1 )"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(n, <span class="fu">paste0</span>(<span class="st">"("</span>,perc_char,<span class="st">")"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "6 (26.1)"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(n, <span class="st">"("</span>,perc_char,<span class="st">")"</span>, <span class="at">sep=</span><span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "6(26.1)"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(n, <span class="st">"("</span>,perc_char,<span class="st">")"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "6(26.1)"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(n, <span class="st">" ("</span>,perc_char,<span class="st">")"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "6 (26.1)"</code></pre>
</div>
</div>
<hr>
<p>I think that it’s clearer to combine <code>paste</code> with <code>paste0</code> rather than add additional whitespace to characters (which is easy to overlook) or changing the separator (which is another argument).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>adsl_mrg_cnt <span class="sc">%&gt;%</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc =</span> <span class="fu">round</span>((n<span class="sc">/</span>N)<span class="sc">*</span><span class="dv">100</span>, <span class="at">digits=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc_char =</span> <span class="fu">format</span>(perc, <span class="at">nsmall=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">npct =</span> <span class="fu">paste</span>(n, </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">paste0</span>( <span class="st">"("</span>, perc_char, <span class="st">")"</span> ) </span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>                      ) </span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>         )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 8
# Groups:   TRT01AN, TRT01A, SEX [6]
  TRT01AN TRT01A               SEX       n     N  perc perc_char npct     
    &lt;dbl&gt; &lt;chr&gt;                &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;    
1       0 Placebo              F        46    79  58.2 58.2      46 (58.2)
2       0 Placebo              M        33    79  41.8 41.8      33 (41.8)
3      54 Xanomeline Low Dose  F        47    81  58   58.0      47 (58.0)
4      54 Xanomeline Low Dose  M        34    81  42   42.0      34 (42.0)
5      81 Xanomeline High Dose F        35    74  47.3 47.3      35 (47.3)
6      81 Xanomeline High Dose M        39    74  52.7 52.7      39 (52.7)</code></pre>
</div>
</div>
<p>Note that in the last line of the chunk above, the code has been formatted carefully to make it clear which brackets and parts of the paste() functions go together. This is a style decision, but making your code easy for others to read and understand helps enormously when it comes to code review. You can find a code style guide here <a href="https://style.tidyverse.org/" class="uri">https://style.tidyverse.org/</a>.</p>
<ol start="10" type="1">
<li>Change the <code>SEX</code> labels to something more readable.</li>
</ol>
<p>At the minute we have values in the <code>SEX</code> variable of “M” and “F”. Now, while this is probably fairly obvious to most, it’s going to be more interpretable if we change these to “Male” and “Female”. This is a fairly simple recoding exercise. {dplyr} has a few options for recoding, but here we’re going to use the <code>recode()</code>function. We need to use this <strong><em>within</em></strong> a <code>mutate()</code> function call. In this case we can reuse the same column name.</p>
<p>The <code>recode()</code> function will leave any values not included in the left-hand of the <code>&lt;old&gt; = &lt;new&gt;</code>as is. The function <code>case_when()</code> allows you to recode with a “catch-all” option (essentially like a sequence of if… elseif… else … statements) and may be more useful in certain circumstances. In this instance with only two values, it’s easier to use <code>recode()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>adsl_mrg_cnt <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc =</span> <span class="fu">round</span>((n<span class="sc">/</span>N)<span class="sc">*</span><span class="dv">100</span>, <span class="at">digits=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc_char =</span> <span class="fu">format</span>(perc, <span class="at">nsmall=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">npct =</span> <span class="fu">paste</span>(n,</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">paste0</span>( <span class="st">"("</span>, perc_char, <span class="st">")"</span> )</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>                      )</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>           ) <span class="sc">%&gt;%</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SEX =</span> <span class="fu">recode</span>(SEX,</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"M"</span> <span class="ot">=</span> <span class="st">"Male"</span>,</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"F"</span> <span class="ot">=</span> <span class="st">"Female"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 8
# Groups:   TRT01AN, TRT01A, SEX [6]
  TRT01AN TRT01A               SEX        n     N  perc perc_char npct     
    &lt;dbl&gt; &lt;chr&gt;                &lt;chr&gt;  &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;    
1       0 Placebo              Female    46    79  58.2 58.2      46 (58.2)
2       0 Placebo              Male      33    79  41.8 41.8      33 (41.8)
3      54 Xanomeline Low Dose  Female    47    81  58   58.0      47 (58.0)
4      54 Xanomeline Low Dose  Male      34    81  42   42.0      34 (42.0)
5      81 Xanomeline High Dose Female    35    74  47.3 47.3      35 (47.3)
6      81 Xanomeline High Dose Male      39    74  52.7 52.7      39 (52.7)</code></pre>
</div>
</div>
<ol start="11" type="1">
<li>Ungroup</li>
</ol>
<p>Notice in the data above is still showing that there are groups defined <code>Groups: TRT01AN, TRT01A, SEX [6]</code>.</p>
<p>Before we do the next thing, it’s going to be a good idea to “turn off” grouping, otherwise R is going to try to do the next action for each value of the grouping variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>adsl_mrg_cnt <span class="sc">%&gt;%</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  TRT01AN TRT01A               SEX       n     N
    &lt;dbl&gt; &lt;chr&gt;                &lt;chr&gt; &lt;int&gt; &lt;int&gt;
1       0 Placebo              F        46    79
2       0 Placebo              M        33    79
3      54 Xanomeline Low Dose  F        47    81
4      54 Xanomeline Low Dose  M        34    81
5      81 Xanomeline High Dose F        35    74
6      81 Xanomeline High Dose M        39    74</code></pre>
</div>
</div>
<ol start="12" type="1">
<li>Using the pipe to chain these steps together.</li>
</ol>
<p>In steps 6, 7, 8 and 9 we have looked at R chunks that merge the data, calculate and format the values for the table. But in each, we’re not particularly interested in saving the intermediate datasets or having to name them. So we can use the pipe function to combine these into one pipeline. In the chunk below, copy and paste the steps below in the right order to get the final data ready for presenting in the table. We have included an additional <code>select()</code> to pick out just the variables needed for the table. The first line should assign the output of the pipeline to the data object <code>adsl_mrg_cnt</code>… (HINT: It may help to say the {dplyr} function name of each step to yourself and think of <code>%&gt;%</code> as “…THEN…” to describe the sequence of steps you need to do)</p>
<ul>
<li><p><code>mutate(perc = round(n/N*100, digits=1)) %&gt;%</code></p></li>
<li><p><code>left_join(Big_N_cnt) %&gt;%</code></p></li>
<li><p><code>mutate(perc_char = format(perc, nsmall=1)) %&gt;%</code></p></li>
<li><p><code>mutate(npct = paste(n, "(", perc_char, ")" ) ) %&gt;%</code></p></li>
<li><p><code>select(TRT01A, SEX, npct)</code></p></li>
<li><p><code>ungroup() %&gt;%</code></p></li>
<li><p><code>mutate(SEX = recode(SEX, "M" = "Male", "F" = "Female")) %&gt;%</code></p></li>
<li><p><code>small_n_cnt %&gt;%</code></p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>adsl_mrg_cnt <span class="ot">&lt;-</span> small_n_cnt <span class="sc">%&gt;%</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(Big_N_cnt) <span class="sc">%&gt;%</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc =</span> <span class="fu">round</span>(n<span class="sc">/</span>N<span class="sc">*</span><span class="dv">100</span>, <span class="at">digits=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc_char =</span> <span class="fu">format</span>(perc, <span class="at">nsmall=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">npct =</span> <span class="fu">paste</span>(n, <span class="st">"("</span>, perc_char, <span class="st">")"</span> ) ) <span class="sc">%&gt;%</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SEX =</span> <span class="fu">recode</span>(SEX, <span class="st">"M"</span> <span class="ot">=</span> <span class="st">"Male"</span>, <span class="st">"F"</span> <span class="ot">=</span> <span class="st">"Female"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(TRT01A, SEX, npct)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(TRT01AN, TRT01A)`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display this data so we can check it</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(adsl_mrg_cnt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  TRT01A               SEX    npct       
  &lt;chr&gt;                &lt;chr&gt;  &lt;chr&gt;      
1 Placebo              Female 46 ( 58.2 )
2 Placebo              Male   33 ( 41.8 )
3 Xanomeline Low Dose  Female 47 ( 58.0 )
4 Xanomeline Low Dose  Male   34 ( 42.0 )
5 Xanomeline High Dose Female 35 ( 47.3 )
6 Xanomeline High Dose Male   39 ( 52.7 )</code></pre>
</div>
</div>
<ol start="13" type="1">
<li>Transpose the data ready for the table</li>
</ol>
<p>This gets us to the point where the data is ready for the table, but we need to arrange the layout to match our expected table format. To do that we need to transpose the data, and to do this we use the {tidyr} package function <code>pivot_wider()</code>. For <code>pivot_wider()</code> you need to tell the function which columns provide names of the new (pivoted) columns - <code>names_from</code> and which columns provide the values for these columns - <code>values_from</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>adsl_mrg_cnt <span class="sc">%&gt;%</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> TRT01A, <span class="at">values_from =</span> npct)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  SEX    Placebo     `Xanomeline Low Dose` `Xanomeline High Dose`
  &lt;chr&gt;  &lt;chr&gt;       &lt;chr&gt;                 &lt;chr&gt;                 
1 Female 46 ( 58.2 ) 47 ( 58.0 )           35 ( 47.3 )           
2 Male   33 ( 41.8 ) 34 ( 42.0 )           39 ( 52.7 )           </code></pre>
</div>
</div>
<hr>
</section>
<section id="challenge-1-you-need-to-complete-this-challenge-to-be-able-to-create-the-final-demog-table." class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="challenge-1-you-need-to-complete-this-challenge-to-be-able-to-create-the-final-demog-table."><span class="header-section-number">3.6</span> Challenge 1: You need to complete this challenge to be able to create the final demog table.</h2>
<p>Repeat the steps above, but add an additional grouping variable to the calculation of Big_N_cnt and small_n_cnt - <code>AGEGRP</code>. Here’s the first step:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Challenge 1: Repeat steps with AGEGRP</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>adsl_saf <span class="ot">&lt;-</span> adsl <span class="sc">%&gt;%</span> <span class="fu">filter</span>(SAFFL <span class="sc">==</span> <span class="st">'Y'</span>)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Calculate Big_N_cnt with AGEGR1N and AGEGR1</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>Big_N_cnt_agegrp <span class="ot">&lt;-</span> adsl_saf <span class="sc">%&gt;%</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(TRT01AN, TRT01A, AGEGR1N, AGEGR1) <span class="sc">%&gt;%</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(<span class="at">name =</span> <span class="st">"N"</span>)</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Big N with Age Group:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Big N with Age Group:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(Big_N_cnt_agegrp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 5
# Groups:   TRT01AN, TRT01A, AGEGR1N, AGEGR1 [9]
  TRT01AN TRT01A               AGEGR1N AGEGR1     N
    &lt;dbl&gt; &lt;chr&gt;                  &lt;dbl&gt; &lt;chr&gt;  &lt;int&gt;
1       0 Placebo                    1 &lt;65       14
2       0 Placebo                    2 65-80     42
3       0 Placebo                    3 &gt;80       30
4      54 Xanomeline Low Dose        1 &lt;65        8
5      54 Xanomeline Low Dose        2 65-80     47
6      54 Xanomeline Low Dose        3 &gt;80       29
7      81 Xanomeline High Dose       1 &lt;65       11
8      81 Xanomeline High Dose       2 65-80     55
9      81 Xanomeline High Dose       3 &gt;80       18</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Calculate small_n_cnt with SEX and AGEGR1N/AGEGR1</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>small_n_cnt_agegrp <span class="ot">&lt;-</span> adsl_saf <span class="sc">%&gt;%</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(TRT01AN, TRT01A, AGEGR1N, AGEGR1, SEX) <span class="sc">%&gt;%</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(<span class="at">name =</span> <span class="st">"n"</span>)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Small n with Age Group and Sex:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Small n with Age Group and Sex:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(small_n_cnt_agegrp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18 × 6
# Groups:   TRT01AN, TRT01A, AGEGR1N, AGEGR1, SEX [18]
   TRT01AN TRT01A               AGEGR1N AGEGR1 SEX       n
     &lt;dbl&gt; &lt;chr&gt;                  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;int&gt;
 1       0 Placebo                    1 &lt;65    F         9
 2       0 Placebo                    1 &lt;65    M         5
 3       0 Placebo                    2 65-80  F        22
 4       0 Placebo                    2 65-80  M        20
 5       0 Placebo                    3 &gt;80    F        22
 6       0 Placebo                    3 &gt;80    M         8
 7      54 Xanomeline Low Dose        1 &lt;65    F         5
 8      54 Xanomeline Low Dose        1 &lt;65    M         3
 9      54 Xanomeline Low Dose        2 65-80  F        28
10      54 Xanomeline Low Dose        2 65-80  M        19
11      54 Xanomeline Low Dose        3 &gt;80    F        17
12      54 Xanomeline Low Dose        3 &gt;80    M        12
13      81 Xanomeline High Dose       1 &lt;65    F         5
14      81 Xanomeline High Dose       1 &lt;65    M         6
15      81 Xanomeline High Dose       2 65-80  F        28
16      81 Xanomeline High Dose       2 65-80  M        27
17      81 Xanomeline High Dose       3 &gt;80    F         7
18      81 Xanomeline High Dose       3 &gt;80    M        11</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Create the full pipeline for adsl_mrg_cnt_agegrp</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>adsl_mrg_cnt_agegrp <span class="ot">&lt;-</span> small_n_cnt_agegrp <span class="sc">%&gt;%</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(Big_N_cnt_agegrp, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"TRT01AN"</span>, <span class="st">"TRT01A"</span>, <span class="st">"AGEGR1N"</span>, <span class="st">"AGEGR1"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc =</span> <span class="fu">round</span>((n<span class="sc">/</span>N)<span class="sc">*</span><span class="dv">100</span>, <span class="at">digits=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc_char =</span> <span class="fu">format</span>(perc, <span class="at">nsmall=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">npct =</span> <span class="fu">paste</span>(n, <span class="st">"("</span>, perc_char, <span class="st">")"</span> ) ) <span class="sc">%&gt;%</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SEX =</span> <span class="fu">recode</span>(SEX, <span class="st">"M"</span> <span class="ot">=</span> <span class="st">"Male"</span>, <span class="st">"F"</span> <span class="ot">=</span> <span class="st">"Female"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select the relevant columns for your final table, including AGEGR1</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(TRT01A, AGEGR1, SEX, npct) <span class="sc">%&gt;%</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Optional: Arrange for better presentation</span></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(TRT01A, AGEGR1, SEX)</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Final Merged and Processed Data for Challenge 1:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Final Merged and Processed Data for Challenge 1:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(adsl_mrg_cnt_agegrp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  TRT01A  AGEGR1 SEX    npct       
  &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;      
1 Placebo 65-80  Female 22 ( 52.4 )
2 Placebo 65-80  Male   20 ( 47.6 )
3 Placebo &lt;65    Female 9 ( 64.3 ) 
4 Placebo &lt;65    Male   5 ( 35.7 ) 
5 Placebo &gt;80    Female 22 ( 73.3 )
6 Placebo &gt;80    Male   8 ( 26.7 ) </code></pre>
</div>
</div>
<p>To check that your code is reproducible, you will want to use the “knit” button on the RStudio IDE interface to create an HTML file based on your saved .Rmd file. If your code chunks are reproducible then you should get an HTML file as a result. If NOT (if there’s an error or if the “knit” process fails) then click on the arrow to the right of the “Run” button and select “Restart R and Run All Chunks”. Then troubleshoot which chunk is causing problems.</p>
</section>
<section id="challenge-2" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="challenge-2"><span class="header-section-number">3.7</span> Challenge 2:</h2>
<p>Generate Counts and Percentages of Body Text Term (AEBODSYS) for Safety Population (SAFFL) based on the this CDISC dataset: <code>adae.xpt</code>. Save the .RMD file on your desktop and click on the “Knit” button at the top of the file to render an HTML version of this document.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Read in the adae data</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>adae <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="at">file =</span> <span class="st">"./data/adae.xpt"</span>)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Filter for Safety Population (SAFFL == 'Y')</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>adae_saf <span class="ot">&lt;-</span> adae <span class="sc">%&gt;%</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SAFFL <span class="sc">==</span> <span class="st">'Y'</span>)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Calculate Big_N for adae_saf (total N per treatment for safety)</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Select only necessary columns from adsl to avoid conflicts and keep relevant info</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>adsl_trt_info <span class="ot">&lt;-</span> adsl <span class="sc">%&gt;%</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(USUBJID, TRT01AN, TRT01A)</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform a left join to add treatment info to adae_saf</span></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>adae_saf_with_trt <span class="ot">&lt;-</span> adae_saf <span class="sc">%&gt;%</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(adsl_trt_info, <span class="at">by =</span> <span class="st">"USUBJID"</span>)</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Calculate small_n (counts of AEBODSYS within each treatment arm)</span></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>Big_N_adae <span class="ot">&lt;-</span> adae_saf_with_trt <span class="sc">%&gt;%</span></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(TRT01AN, TRT01A) <span class="sc">%&gt;%</span></span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">N =</span> <span class="fu">n_distinct</span>(USUBJID), <span class="at">.groups =</span> <span class="st">'drop'</span>) <span class="co"># Count distinct subjects per treatment</span></span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>                                                     <span class="co"># .groups = 'drop' removes grouping at the end</span></span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>small_n_adae <span class="ot">&lt;-</span> adae_saf_with_trt <span class="sc">%&gt;%</span></span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(TRT01AN, TRT01A, AEBODSYS) <span class="sc">%&gt;%</span></span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(<span class="at">name =</span> <span class="st">"n"</span>) <span class="sc">%&gt;%</span> <span class="co"># Counts occurrences of each AEBODSYS within each treatment group</span></span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="co"># Ungroup temporarily for clearer view before final pipeline</span></span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>adae_table_data <span class="ot">&lt;-</span> small_n_adae <span class="sc">%&gt;%</span></span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(Big_N_adae, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"TRT01AN"</span>, <span class="st">"TRT01A"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc =</span> <span class="fu">round</span>((n<span class="sc">/</span>N)<span class="sc">*</span><span class="dv">100</span>, <span class="at">digits=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc_char =</span> <span class="fu">format</span>(perc, <span class="at">nsmall=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">npct =</span> <span class="fu">paste0</span>(n, <span class="st">" ("</span>, perc_char, <span class="st">"%)"</span>)) <span class="sc">%&gt;%</span> <span class="co"># Common format: n (perc%)</span></span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select the relevant columns for your final table</span></span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(TRT01A, AEBODSYS, npct) <span class="sc">%&gt;%</span></span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Arrange for better presentation (first by treatment numeric, then by AEBODSYS)</span></span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We need TRT01AN temporarily back for sorting correctly.</span></span>
<span id="cb64-38"><a href="#cb64-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">select</span>(Big_N_adae, TRT01AN, TRT01A), <span class="at">by =</span> <span class="st">"TRT01A"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-39"><a href="#cb64-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(TRT01AN, AEBODSYS) <span class="sc">%&gt;%</span></span>
<span id="cb64-40"><a href="#cb64-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>TRT01AN) <span class="co"># Remove TRT01AN after sorting</span></span>
<span id="cb64-41"><a href="#cb64-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-42"><a href="#cb64-42" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(adae_table_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  TRT01A  AEBODSYS                                             npct       
  &lt;chr&gt;   &lt;chr&gt;                                                &lt;chr&gt;      
1 Placebo CARDIAC DISORDERS                                    27 ( 39.1%)
2 Placebo EAR AND LABYRINTH DISORDERS                          2 (  2.9%) 
3 Placebo EYE DISORDERS                                        8 ( 11.6%) 
4 Placebo GASTROINTESTINAL DISORDERS                           26 ( 37.7%)
5 Placebo GENERAL DISORDERS AND ADMINISTRATION SITE CONDITIONS 48 ( 69.6%)
6 Placebo HEPATOBILIARY DISORDERS                              1 (  1.4%) </code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./MiniProject1.html" class="pagination-link" aria-label="Mini-project 1 - Reading and exploring datasets">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Mini-project 1 - Reading and exploring datasets</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./MiniProject4.html" class="pagination-link" aria-label="Mini-project 4 - Creating summary table data">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Mini-project 4 - Creating summary table data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>