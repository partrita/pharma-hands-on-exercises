<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Mike K Smith">
<meta name="dcterms.date" content="2023-03-02">

<title>7&nbsp; Mini-project 7 - Getting started writing functions – Pharma Hands-on Exercises</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./MiniProject8.html" rel="next">
<link href="./MiniProject6.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-cd63b520c5e060288b5099369e8bcbf0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./MiniProject7.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Mini-project 7 - Getting started writing functions</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Pharma Hands-on Exercises</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Abstract</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MiniProject1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Mini-project 1 - Reading and exploring datasets</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MiniProject2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Mini-project 2 - Summarising continuous and categorical data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MiniProject3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Mini-project 3 - Generating grouped summary statistics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MiniProject4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Mini-project 4 - Creating summary table data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MiniProject5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Mini-project 5 - Getting started with {ggplot2}</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MiniProject6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Mini-project 6 - {ggplot2} extensions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MiniProject7.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Mini-project 7 - Getting started writing functions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MiniProject8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Mini-project 8 - Applying functions through iteration</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MiniProject9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Mini-project 9 - Reproducible examples and {reprex}</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MiniProject10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Mini-project 10 - Debugging</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MiniProject11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Mini-project 11 - Tidy evaluation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MiniProject12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Mini-project 12 - Testing</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MiniProject13.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Mini-project13 - Code style</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MiniProject14.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Mini-project 14 - R snippets</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">7.1</span> 1. Introduction</a></li>
  <li><a href="#features-of-a-function" id="toc-features-of-a-function" class="nav-link" data-scroll-target="#features-of-a-function"><span class="header-section-number">7.2</span> 2. Features of a function</a></li>
  <li><a href="#create-a-function" id="toc-create-a-function" class="nav-link" data-scroll-target="#create-a-function"><span class="header-section-number">7.3</span> 3. Create a function</a></li>
  <li><a href="#apply-the-function-to-the-cdisc-dataset." id="toc-apply-the-function-to-the-cdisc-dataset." class="nav-link" data-scroll-target="#apply-the-function-to-the-cdisc-dataset."><span class="header-section-number">7.4</span> 4. Apply the function to the CDISC dataset.</a></li>
  <li><a href="#defensive-programming" id="toc-defensive-programming" class="nav-link" data-scroll-target="#defensive-programming"><span class="header-section-number">7.5</span> 5. Defensive programming</a></li>
  <li><a href="#review-and-refactor.-often." id="toc-review-and-refactor.-often." class="nav-link" data-scroll-target="#review-and-refactor.-often."><span class="header-section-number">7.6</span> 6. Review and refactor. Often.</a></li>
  <li><a href="#troubleshooting-and-debugging-functions" id="toc-troubleshooting-and-debugging-functions" class="nav-link" data-scroll-target="#troubleshooting-and-debugging-functions"><span class="header-section-number">7.7</span> 7. Troubleshooting and debugging functions</a></li>
  <li><a href="#you-dont-need-to-specify-all-the-arguments---ellipses" id="toc-you-dont-need-to-specify-all-the-arguments---ellipses" class="nav-link" data-scroll-target="#you-dont-need-to-specify-all-the-arguments---ellipses"><span class="header-section-number">7.8</span> 8. You don’t need to specify ALL the arguments - ellipses</a></li>
  <li><a href="#challenge" id="toc-challenge" class="nav-link" data-scroll-target="#challenge"><span class="header-section-number">7.9</span> Challenge</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Mini-project 7 - Getting started writing functions</span></h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Mike K Smith </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 2, 2023</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">7.1</span> 1. Introduction</h2>
<p>We will introduce functions, how to write functions and how to troubleshoot when something goes wrong in a function. Functions are really important in using R. <strong>The rule of thumb is if you copy code more than twice, you should write a function</strong>. R packages which you import using the <code>library( )</code> statement are essentially collections of functions, documentation, tests and occasionally data. As we go further down our journey learning R it will be more and more important to understand how to use functions, how to write them and how to extend them to do different things.</p>
<p>A function is a little like a SAS Macro. When you first write the function you will want to convert from “open” code, identifying the input (data, list or object) and deciding what operations you want to apply to that object. Then, as you refine the function you can add arguments which will allow the user to tailor actions depending on the values of those arguments. We’ll look at how to achieve this within this MiniProject.</p>
<p>To illustrate this we will return an example from MiniProject 2 where we calculated the number of observations within a dataset and calculated numbers and proportions within a category. Recall that section</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rio)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>adsl_saf <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">"./data/adsl.xpt"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(SAFFL <span class="sc">==</span> <span class="st">"Y"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  Big_N_cnt <span class="ot">&lt;-</span> adsl_saf <span class="sc">%&gt;%</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>( TRT01AN, TRT01A  ) <span class="sc">%&gt;%</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(<span class="at">name =</span> <span class="st">"N"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  Big_N_cnt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
# Groups:   TRT01AN, TRT01A [3]
  TRT01AN TRT01A                   N
    &lt;dbl&gt; &lt;chr&gt;                &lt;int&gt;
1       0 Placebo                 86
2      54 Xanomeline Low Dose     84
3      81 Xanomeline High Dose    84</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>  small_n_cnt <span class="ot">&lt;-</span> adsl_saf <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>( TRT01AN, TRT01A,  SEX ) <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(<span class="at">name =</span> <span class="st">"n"</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  small_n_cnt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
# Groups:   TRT01AN, TRT01A, SEX [6]
  TRT01AN TRT01A               SEX       n
    &lt;dbl&gt; &lt;chr&gt;                &lt;chr&gt; &lt;int&gt;
1       0 Placebo              F        53
2       0 Placebo              M        33
3      54 Xanomeline Low Dose  F        50
4      54 Xanomeline Low Dose  M        34
5      81 Xanomeline High Dose F        40
6      81 Xanomeline High Dose M        44</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>  adsl_mrg_cnt <span class="ot">&lt;-</span> small_n_cnt <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(Big_N_cnt, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"TRT01A"</span>, <span class="st">"TRT01AN"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">perc =</span> <span class="fu">round</span>((n<span class="sc">/</span>N)<span class="sc">*</span><span class="dv">100</span>, <span class="at">digits=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">perc_char =</span> <span class="fu">format</span>(perc, <span class="at">nsmall=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">npct =</span> <span class="fu">paste</span>(n, </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">paste0</span>( <span class="st">"("</span>, perc_char, <span class="st">")"</span> ) </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>                        ) </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>           ) <span class="sc">%&gt;%</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">SEX =</span> <span class="fu">recode</span>(SEX, </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"M"</span> <span class="ot">=</span> <span class="st">"Male"</span>,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"F"</span> <span class="ot">=</span> <span class="st">"Female"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(TRT01A, SEX, npct) <span class="sc">%&gt;%</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> TRT01A, <span class="at">values_from =</span> npct)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  adsl_mrg_cnt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  SEX    Placebo   `Xanomeline Low Dose` `Xanomeline High Dose`
  &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;                 &lt;chr&gt;                 
1 Female 53 (61.6) 50 (59.5)             40 (47.6)             
2 Male   33 (38.4) 34 (40.5)             44 (52.4)             </code></pre>
</div>
</div>
</section>
<section id="features-of-a-function" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="features-of-a-function"><span class="header-section-number">7.2</span> 2. Features of a function</h2>
<p>Looking at the above code, we might want to run the same code for the <code>adsl</code> dataset from a different study. We could copy the code, but it might be more useful to turn the code above into a function if we wish to perform the same action across multiple studies.</p>
<section id="function-structure" class="level4" data-number="7.2.0.1">
<h4 data-number="7.2.0.1" class="anchored" data-anchor-id="function-structure"><span class="header-section-number">7.2.0.1</span> Function structure</h4>
<p>Functions in R have a few key attributes:</p>
<ul>
<li><p>Function name</p></li>
<li><p>Function inputs and arguments</p></li>
<li><p>Function body where you write code.</p></li>
<li><p>A returned object from the code (or sometimes not an object but an action, which in R we call a “side-effect”). For example we might return data (an object) but we might write data to a file (a side-effect).</p></li>
</ul>
</section>
<section id="function-name" class="level4" data-number="7.2.0.2">
<h4 data-number="7.2.0.2" class="anchored" data-anchor-id="function-name"><span class="header-section-number">7.2.0.2</span> Function name</h4>
<p>Function names are hard. You need to pick a name that isn’t going to clash with an existing function from a library that you’re using (or likely to use). For example, calling a function <code>mean</code> should probably be avoided as most folks will have a good idea what the default <code>mean</code> function should do. The function name should be <strong><em>descriptive</em></strong>, and is probably better as a verb: <code>addLabels</code> is better than <code>myFunction4</code>. I choose verbs because you are <strong><em>doing</em></strong> something to the inputs.</p>
<p>You can check whether the named function already exists. Copy and paste the following code to the Console.</p>
<pre><code>??mean</code></pre>
</section>
<section id="function-arguments" class="level4" data-number="7.2.0.3">
<h4 data-number="7.2.0.3" class="anchored" data-anchor-id="function-arguments"><span class="header-section-number">7.2.0.3</span> Function arguments</h4>
<p>Functions don’t <strong><em>need</em></strong> to have arguments, but they typically do. In the {tidyverse} the first argument is usually the input object or data. This is so that you can easily put the function into a {tidyverse} pipeline. Other arguments help the user of the function to tweak settings or make choices about what the function does. When you first write a function it’s a good idea to reduce the number of arguments to an absolutely minimum until you get the basics working. Then you can slowly add arguments.</p>
</section>
<section id="function-body" class="level4" data-number="7.2.0.4">
<h4 data-number="7.2.0.4" class="anchored" data-anchor-id="function-body"><span class="header-section-number">7.2.0.4</span> Function body</h4>
<p>This is where the code lives. If you have more than one line of code, then you should put the body of the function in curly brackets: <code>{ }</code>. The last thing that you write in the function body is the returned object from the function.</p>
<p><strong><em>NOTE:</em></strong> Within the function body, R uses a new environment. This means that variables and objects you create inside the function <strong><em>stay inside the function</em></strong> unless you make them available in the returned object. This can cause difficulties and confusion when you try to debug functions, but we’ll look at that separately later.</p>
<p>You can call functions from within functions (<em>ad infinitum</em>). This is a useful trick since you can build up helper functions and use these in higher-level functions and essentially this is how many R packages are built - wrapping up functions into a bundle and them making them available to share. This also means that debugging functions can get a little hairy as you go down the rabbit hole.</p>
</section>
<section id="returned-object" class="level4" data-number="7.2.0.5">
<h4 data-number="7.2.0.5" class="anchored" data-anchor-id="returned-object"><span class="header-section-number">7.2.0.5</span> Returned object</h4>
<p>Because the objects we create in a function exist in a whole separate environment, we need to tell R which ones to return back to us when the function is finished. These objects are what is known as the “returned” values. If you are writing a function that will be used in a tidyverse workflow, it’s a good idea to return a <code>tibble</code>. This means you can continue to pipe the returned object forward to another step. If you’re working outside of a tidyverse workflow (or if your function is the “last step”) then you have more flexibility in returning whatever you like. Your function <strong><em>does not have to</em></strong> return an object, for example if your function writes data to file.</p>
<p>In the tidyverse then, <code>tibbles</code> are our preferred output object. Apart from <code>tibbles</code>, a good catch all object is a <code>list</code> object, since this can contain a collection of items including data, vectors, other lists etc.</p>
<p>Here are some examples.</p>
<ul>
<li><code>myFunction1</code> below does not return an object, so when you run the function, nothing is returned (although the function actions are performed). Run this code and see if there is an object called <code>output</code> in the environment.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>myData <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>Treatment, <span class="sc">~</span>value,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Placebo"</span>, <span class="dv">1</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Placebo"</span>, <span class="dv">2</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Active"</span>, <span class="dv">3</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Active"</span>, <span class="dv">4</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>myFunction1 <span class="ot">&lt;-</span> <span class="cf">function</span>(data){</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Treatment) <span class="sc">%&gt;%</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>())</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="fu">myFunction1</span>(myData)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the following code, the <code>output</code> object has an implicit <code>print</code> statement which will mean that the function returns it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>myFunction2 <span class="ot">&lt;-</span> <span class="cf">function</span>(data){</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Treatment) <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>())</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  output</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="fu">myFunction2</span>(myData)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the last snippet, we formally return the output object. Using a <code>return</code> statement is good practice as it makes it really clear to a reviewer what is being returned from the function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>myFunction3 <span class="ot">&lt;-</span> <span class="cf">function</span>(data){</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Treatment) <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>())</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.csv</span>(<span class="at">x =</span> output, <span class="at">file =</span> <span class="st">"output.csv"</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="fu">myFunction3</span>(myData)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="create-a-function" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="create-a-function"><span class="header-section-number">7.3</span> 3. Create a function</h2>
<p>Now let’s take the code below and turn it into a function. We can use RStudio IDE “snippets” to write the function. At the Console <code>&gt;</code> prompt in the RStudio IDE type “fun” then hit TAB key. Select <code>fun</code> from the {snippets} option. This writes a scaffolding snippet for you to complete. Give the function a name e.g.&nbsp;“myFunction1” then use the TAB key to move to the function “variables” and rename this to “inputVariable”. Now hi the TAB key again to move to between the function brackets <code>{ }</code> where you would write your function code.</p>
<p>Use the RStudio IDE <code>fun</code> snippet to create a function called “adsl_counts” based on the code below and copy the code into the body of that function. Your <code>adsl_counts</code> function should have an argument called <code>dataFile</code> and you should make sure that this argument is used within the <code>read_xpt</code> function to provide the path to the CDISC dataset for the <code>data_file</code> argument of <code>read_xpt</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>adsl_counts <span class="ot">&lt;-</span> <span class="cf">function</span>(dataFile){</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a> adsl_saf <span class="ot">&lt;-</span> haven<span class="sc">::</span><span class="fu">read_xpt</span>(dataFile) <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(SAFFL <span class="sc">==</span> <span class="st">"Y"</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  Big_N_cnt <span class="ot">&lt;-</span>  adsl_saf <span class="sc">%&gt;%</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>( TRT01AN, TRT01A  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(<span class="at">name =</span> <span class="st">"N"</span>)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  Big_N_cnt</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  small_n_cnt <span class="ot">&lt;-</span> adsl_saf <span class="sc">%&gt;%</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>( TRT01AN, TRT01A,  SEX ) <span class="sc">%&gt;%</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(<span class="at">name =</span> <span class="st">"n"</span>)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  small_n_cnt</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  adsl_mrg_cnt <span class="ot">&lt;-</span> small_n_cnt <span class="sc">%&gt;%</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(Big_N_cnt, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"TRT01A"</span>, <span class="st">"TRT01AN"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">perc =</span> <span class="fu">round</span>((n<span class="sc">/</span>N)<span class="sc">*</span><span class="dv">100</span>, <span class="at">digits=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">perc_char =</span> <span class="fu">format</span>(perc, <span class="at">nsmall=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">npct =</span> <span class="fu">paste</span>(n, </span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">paste0</span>( <span class="st">"("</span>, perc_char, <span class="st">")"</span> ) </span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>                        ) </span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>           ) <span class="sc">%&gt;%</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">SEX =</span> <span class="fu">recode</span>(SEX, </span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"M"</span> <span class="ot">=</span> <span class="st">"Male"</span>,</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"F"</span> <span class="ot">=</span> <span class="st">"Female"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(TRT01A, SEX, npct) <span class="sc">%&gt;%</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> TRT01A, <span class="at">values_from =</span> npct) </span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(adsl_mrg_cnt)</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Running the finished function code above creates an R object of type function. You can see it in your Environment. Click on the function name or the “Script” icon to the right to view your function code.</p>
</section>
<section id="apply-the-function-to-the-cdisc-dataset." class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="apply-the-function-to-the-cdisc-dataset."><span class="header-section-number">7.4</span> 4. Apply the function to the CDISC dataset.</h2>
<p>Now test your code by creating a character string of the path to a CDISC <code>adsl</code> dataset and running your function. Note that you don’t need to put the full path into the function call. Below we’ve created an object containing that path, then we’re passing this into the function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>inFile <span class="ot">&lt;-</span> <span class="st">"./data/adsl.xpt"</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">adsl_counts</span>(inFile)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  SEX    Placebo   `Xanomeline Low Dose` `Xanomeline High Dose`
  &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;                 &lt;chr&gt;                 
1 Female 53 (61.6) 50 (59.5)             40 (47.6)             
2 Male   33 (38.4) 34 (40.5)             44 (52.4)             </code></pre>
</div>
</div>
</section>
<section id="defensive-programming" class="level2" data-number="7.5">
<h2 data-number="7.5" class="anchored" data-anchor-id="defensive-programming"><span class="header-section-number">7.5</span> 5. Defensive programming</h2>
<p>What happens if we don’t pass in an ADaM dataset?</p>
<p>Well this is a case where you might want to write some additional code to check the type of input and stop execution if it’s not the correct type. How can we tell if the dataset is ADaM format? One way is just to see if the file is called <code>adsl</code>. The <code>{stringr}</code> package contains helpful function for working with character strings… Let’s use <code>str_detect</code>. Note here, I’m prefixing <code>str_detect</code> with <code>stringr::</code> in order to explicitly tell R <strong><em>(and you!)</em></strong> that <code>str_detect</code> is coming from the <code>{stringr}</code> package. You don’t <strong><em>HAVE</em></strong> to do this, but it’s often helpful for anyone reviewing your code which package a specific function comes from.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>stringr<span class="sc">::</span><span class="fu">str_detect</span>(inFile, <span class="st">"adsl"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>R has some functions which help you pass messages, warnings and error messages back to the user. It’s a good idea when you write functions to try to make these messages meaningful so that the user can figure out what went wrong and how to correct this. The <code>try</code> function will attempt to run some code, and if it fails the <code>stop</code> message will be displayed. Try it out for various values of <code>inFile</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(<span class="cf">if</span>(<span class="sc">!</span>stringr<span class="sc">::</span><span class="fu">str_detect</span>(inFile, <span class="st">"adsl"</span>)) <span class="fu">stop</span>(<span class="st">"Input data is not CDISC adsl dataset"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now try applying the <code>adsl_counts</code>function to using a dataset that isn’t an ADaM dataset (or one that isn’t <code>adsl</code>).</p>
<section id="naming-arguments-is-hard" class="level4" data-number="7.5.0.1">
<h4 data-number="7.5.0.1" class="anchored" data-anchor-id="naming-arguments-is-hard"><span class="header-section-number">7.5.0.1</span> Naming arguments is hard</h4>
<p>In the function above we named the argument <code>dataFile</code>. But this doesn’t give the user much clue what kind of input or data file is expected. It’s not immediately clear that what is expected is a character string file path to an “adsl” ADaM dataset. Maybe if we (re)named it <code>adsl_FilePath</code> then it would give users much more clue what kind of data is used in the function, and we would avoid difficulties before they arise.</p>
<p>My recommendation is to write the function, check that it works, THEN go back through and make changes to rename items. You can use the RStudio IDE to help:</p>
<ol type="1">
<li><p>double click on the argument <code>dataFile</code> - note how the IDE finds all instances of <code>dataFile</code> within the function</p></li>
<li><p>from the “Code” menu, select “Rename in scope” - type <code>adsl_File</code> to rename the argument AND instances of this argument <strong><em>within the function</em></strong>.</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>adsl_counts <span class="ot">&lt;-</span> <span class="cf">function</span>(dataFile){</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    adsl_saf <span class="ot">&lt;-</span> haven<span class="sc">::</span><span class="fu">read_xpt</span>(dataFile) <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(SAFFL <span class="sc">==</span> <span class="st">"Y"</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  Big_N_cnt <span class="ot">&lt;-</span> adsl_saf <span class="sc">%&gt;%</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>( TRT01AN, TRT01A  ) <span class="sc">%&gt;%</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(<span class="at">name =</span> <span class="st">"N"</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  Big_N_cnt</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  small_n_cnt <span class="ot">&lt;-</span> adsl_saf <span class="sc">%&gt;%</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>( TRT01AN, TRT01A,  SEX ) <span class="sc">%&gt;%</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(<span class="at">name =</span> <span class="st">"n"</span>)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  small_n_cnt</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  adsl_mrg_cnt <span class="ot">&lt;-</span> small_n_cnt <span class="sc">%&gt;%</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(Big_N_cnt, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"TRT01A"</span>, <span class="st">"TRT01AN"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">perc =</span> <span class="fu">round</span>((n<span class="sc">/</span>N)<span class="sc">*</span><span class="dv">100</span>, <span class="at">digits=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">perc_char =</span> <span class="fu">format</span>(perc, <span class="at">nsmall=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">npct =</span> <span class="fu">paste</span>(n, </span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">paste0</span>( <span class="st">"("</span>, perc_char, <span class="st">")"</span> ) </span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>                        ) </span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>           ) <span class="sc">%&gt;%</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">SEX =</span> <span class="fu">recode</span>(SEX, </span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"M"</span> <span class="ot">=</span> <span class="st">"Male"</span>,</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"F"</span> <span class="ot">=</span> <span class="st">"Female"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(TRT01A, SEX, npct) <span class="sc">%&gt;%</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> TRT01A, <span class="at">values_from =</span> npct)</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>  adsl_mrg_cnt</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="review-and-refactor.-often." class="level2" data-number="7.6">
<h2 data-number="7.6" class="anchored" data-anchor-id="review-and-refactor.-often."><span class="header-section-number">7.6</span> 6. Review and refactor. Often.</h2>
<p>As you learn stuff in R, you’ll find new ways of doing things - they might be more efficient / faster, are able to be done in parallel, or where some complex piece of code can be made more simple. It’s good practice to come back around to your functions from time to time, to check that they still make sense and if there’s anything that can be improved.</p>
<p>Good functions should be easy to read, review, and improve. In the code above, the function takes the github path and does everything from reading the xpt dataset to producing the table content. But we might be able to simplify things if the code <strong><em>only</em></strong> produces the summarised counts, rather than reading the data. Reading data over the network is comparatively slow. So we only want to do that once in a session, if we can.</p>
<p>As we said earlier, if we’re writing functions for use in <code>{tidyverse}</code> data pipelines, we should expect a tibble / dataset as an input and return another tibble / dataset. But here what’s expected as an input is a <strong><em>character string file path</em></strong>. That’s not ideal. Let’s reorganise (we call it refactor) the code so that we take the file reading outside the function, and instead assume that what is being passed in is the “adsl” <strong><em>dataset</em></strong>.</p>
<p>Amend the function code below to instead calculate based on an input dataset, like the <code>adsl_saf</code> data. You’ll need to update code for <code>Big_N_cnt</code> and <code>small_n_cnt</code> to point to the input to the function (the input dataset). Check that the code works by running the chunk.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make sure you have necessary libraries loaded</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># For dplyr functions like filter, mutate, group_by, summarise, etc.</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)     <span class="co"># For read_xpt()</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Refactored adsl_counts function: now takes a data frame as input</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>adsl_counts <span class="ot">&lt;-</span> <span class="cf">function</span>(.data) { <span class="co"># Changed argument name to .data (common tidyverse convention for input data)</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># REMOVE THE FILE READING AND INITIAL FILTERING FROM HERE</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># adsl_saf &lt;- haven::read_xpt(adsl_FilePath) %&gt;% filter(SAFFL == "Y")</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Also remove the SEX recode from here if it's done as part of the initial data prep</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Now, Big_N_cnt and small_n_cnt directly operate on the input .data</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  Big_N_cnt <span class="ot">&lt;-</span> .data <span class="sc">%&gt;%</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>( TRT01AN, TRT01A ) <span class="sc">%&gt;%</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(<span class="at">name =</span> <span class="st">"N"</span>, <span class="at">.groups =</span> <span class="st">'drop'</span>) <span class="co"># Added .groups = 'drop' for robustness</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  small_n_cnt <span class="ot">&lt;-</span> .data <span class="sc">%&gt;%</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>( TRT01AN, TRT01A, SEX ) <span class="sc">%&gt;%</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(<span class="at">name =</span> <span class="st">"n"</span>, <span class="at">.groups =</span> <span class="st">'drop'</span>) <span class="co"># Added .groups = 'drop' for robustness</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>  adsl_mrg_cnt <span class="ot">&lt;-</span> small_n_cnt <span class="sc">%&gt;%</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(Big_N_cnt, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"TRT01A"</span>, <span class="st">"TRT01AN"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">perc =</span> <span class="fu">round</span>((n<span class="sc">/</span>N)<span class="sc">*</span><span class="dv">100</span>, <span class="at">digits=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">perc_char =</span> <span class="fu">format</span>(perc, <span class="at">nsmall=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">npct =</span> <span class="fu">paste</span>(n,</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">paste0</span>( <span class="st">"("</span>, perc_char, <span class="st">")"</span> )</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>                        )</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>           ) <span class="sc">%&gt;%</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure SEX is already recoded before this point, or recode here if preferred</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Based on the refactoring prompt, initial data prep should include SEX recode.</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(TRT01A, SEX, npct) <span class="sc">%&gt;%</span></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> TRT01A, <span class="at">values_from =</span> npct)</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(adsl_mrg_cnt)</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a><span class="co"># The path to your data file</span></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>inFile <span class="ot">&lt;-</span> <span class="st">"./data/adsl.xpt"</span></span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare the data *before* passing it to the adsl_counts function</span></span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>table1 <span class="ot">&lt;-</span> haven<span class="sc">::</span><span class="fu">read_xpt</span>(inFile) <span class="sc">%&gt;%</span> <span class="co"># First, read the file</span></span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SAFFL <span class="sc">==</span> <span class="st">"Y"</span>) <span class="sc">%&gt;%</span>           <span class="co"># Then, filter it</span></span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SEX =</span> <span class="fu">recode</span>(SEX, <span class="st">"M"</span> <span class="ot">=</span> <span class="st">"Male"</span>, <span class="st">"F"</span> <span class="ot">=</span> <span class="st">"Female"</span>)) <span class="sc">%&gt;%</span> <span class="co"># And recode SEX here</span></span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Now, pass the *prepared data frame* to your adsl_counts function</span></span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adsl_counts</span>()</span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>table1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  SEX    Placebo   `Xanomeline Low Dose` `Xanomeline High Dose`
  &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;                 &lt;chr&gt;                 
1 Female 53 (61.6) 50 (59.5)             40 (47.6)             
2 Male   33 (38.4) 34 (40.5)             44 (52.4)             </code></pre>
</div>
</div>
</section>
<section id="troubleshooting-and-debugging-functions" class="level2" data-number="7.7">
<h2 data-number="7.7" class="anchored" data-anchor-id="troubleshooting-and-debugging-functions"><span class="header-section-number">7.7</span> 7. Troubleshooting and debugging functions</h2>
<p>Functions that have only one argument or input are typically easy to debug. In the console, create an object with the same name as the argument, then step through the code body of the function one line at a time, until you identify the issue.</p>
<p>But typically, functions have many more arguments and it gets tedious very quickly to assign all these to objects and then step through the code. However, R and the RStudio IDE provide some helpful tools for debugging. See this article: <a href="https://support.rstudio.com/hc/en-us/articles/205612627-Debugging-with-the-RStudio-IDE" class="uri">https://support.rstudio.com/hc/en-us/articles/205612627-Debugging-with-the-RStudio-IDE</a></p>
<p>Jenny Bryan’s talk from RStudioConf 2020 was a great exposition of what to do when your code goes wrong: <a href="https://www.rstudio.com/resources/rstudioconf-2020/object-of-type-closure-is-not-subsettable/" class="uri">https://www.rstudio.com/resources/rstudioconf-2020/object-of-type-closure-is-not-subsettable/</a></p>
<p>I <strong><em>STRONGLY RECOMMEND</em></strong> that you go and review the material and video linked here. It’ll help you <strong><em>ENORMOUSLY</em></strong>.</p>
</section>
<section id="you-dont-need-to-specify-all-the-arguments---ellipses" class="level2" data-number="7.8">
<h2 data-number="7.8" class="anchored" data-anchor-id="you-dont-need-to-specify-all-the-arguments---ellipses"><span class="header-section-number">7.8</span> 8. You don’t need to specify ALL the arguments - ellipses</h2>
<p>As you write functions you might find yourself adding more and more and more arguments to handle various options within the function. Typically these are additional arguments to functions used within the main function. But there’s an easy way to extend function calls to allow this. If we type <code>...</code> as an argument to the function we can pass arguments down into lower level functions used within the parent function. We add the same <code>...</code> to these function calls, like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>mySummary <span class="ot">&lt;-</span> <span class="cf">function</span>(myData, ...){</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  myData <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>( TRT01AN, TRT01A ) <span class="sc">%&gt;%</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">round</span>(<span class="fu">mean</span>(AGE), ... ))</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="fu">mySummary</span>(adsl_saf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'TRT01AN'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
# Groups:   TRT01AN [3]
  TRT01AN TRT01A                mean
    &lt;dbl&gt; &lt;chr&gt;                &lt;dbl&gt;
1       0 Placebo                 75
2      54 Xanomeline Low Dose     76
3      81 Xanomeline High Dose    74</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mySummary</span>(adsl_saf, <span class="at">digits =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'TRT01AN'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
# Groups:   TRT01AN [3]
  TRT01AN TRT01A                mean
    &lt;dbl&gt; &lt;chr&gt;                &lt;dbl&gt;
1       0 Placebo               75.2
2      54 Xanomeline Low Dose   75.7
3      81 Xanomeline High Dose  74.4</code></pre>
</div>
</div>
<p>In the code above we are allowing the user to pass the <code>digits</code> argument through to the <code>round</code> function. The <code>.</code> ellipses say “Whatever extra arguments the user gives, pass them through…”. And the <code>.</code> in the <code>round</code> function say “Whatever extra arguments the user gives, use them here…”. Note that lower level function arguments passed via ellipses must be valid arguments… You just need to be careful if there is more than one function with the same named arguments… Naming things is hard.</p>
</section>
<section id="challenge" class="level2" data-number="7.9">
<h2 data-number="7.9" class="anchored" data-anchor-id="challenge"><span class="header-section-number">7.9</span> Challenge</h2>
<p>Convert the code you wrote in the Mini Project 6 challenge into a function that takes an input <code>adlb</code> dataset and produces the graph. For an additional challenge, allow the user to specify the axes labels.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./MiniProject6.html" class="pagination-link" aria-label="Mini-project 6 - {ggplot2} extensions">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Mini-project 6 - {ggplot2} extensions</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./MiniProject8.html" class="pagination-link" aria-label="Mini-project 8 - Applying functions through iteration">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Mini-project 8 - Applying functions through iteration</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>