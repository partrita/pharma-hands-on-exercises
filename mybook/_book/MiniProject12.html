<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Natalia Andriychuk">
<meta name="dcterms.date" content="2023-03-17">

<title>8&nbsp; Mini-project 12 - Testing – Pharma Hands-on Exercises</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./MiniProject13.html" rel="next">
<link href="./MiniProject11.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-cd63b520c5e060288b5099369e8bcbf0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./MiniProject12.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Mini-project 12 - Testing</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Pharma Hands-on Exercises</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Abstract</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MiniProject1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Mini-project 1 - Reading and exploring datasets</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MiniProject2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Mini-project 2 - Summarising continuous and categorical data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MiniProject4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Mini-project 4 - Creating summary table data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MiniProject5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Mini-project 5 - Getting started with {ggplot2}</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MiniProject9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Mini-project 9 - Reproducible examples and {reprex}</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MiniProject10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Mini-project 10 - Debugging</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MiniProject11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Mini-project 11 - Tidy evaluation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MiniProject12.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Mini-project 12 - Testing</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MiniProject13.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Mini-project13 - Code style</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MiniProject14.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Mini-project 14 - R snippets</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">8.1</span> Introduction</a></li>
  <li><a href="#benefits-of-testing" id="toc-benefits-of-testing" class="nav-link" data-scroll-target="#benefits-of-testing"><span class="header-section-number">8.2</span> Benefits of testing</a></li>
  <li><a href="#writing-testable-code" id="toc-writing-testable-code" class="nav-link" data-scroll-target="#writing-testable-code"><span class="header-section-number">8.3</span> Writing testable code</a></li>
  <li><a href="#automated-testing-with-testthat" id="toc-automated-testing-with-testthat" class="nav-link" data-scroll-target="#automated-testing-with-testthat"><span class="header-section-number">8.4</span> Automated testing with {testthat}</a></li>
  <li><a href="#expectations" id="toc-expectations" class="nav-link" data-scroll-target="#expectations"><span class="header-section-number">8.5</span> Expectations</a></li>
  <li><a href="#writing-testable-code---example" id="toc-writing-testable-code---example" class="nav-link" data-scroll-target="#writing-testable-code---example"><span class="header-section-number">8.6</span> Writing testable code - example</a></li>
  <li><a href="#writing-tests" id="toc-writing-tests" class="nav-link" data-scroll-target="#writing-tests"><span class="header-section-number">8.7</span> Writing tests</a></li>
  <li><a href="#organize-and-run-your-tests" id="toc-organize-and-run-your-tests" class="nav-link" data-scroll-target="#organize-and-run-your-tests"><span class="header-section-number">8.8</span> Organize and run your tests</a></li>
  <li><a href="#challenge" id="toc-challenge" class="nav-link" data-scroll-target="#challenge"><span class="header-section-number">8.9</span> Challenge</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Mini-project 12 - Testing</span></h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Natalia Andriychuk </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 17, 2023</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p><code>{testthat}</code> is a new package we will be using in this project. Please install before beginning this exercise.</p>
<section id="introduction" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">8.1</span> Introduction</h2>
<p>In this Mini-Project we’ll look at how to test your code in R. Testing your code can be painful and tedious, but it greatly increases the quality of your code. It ensures that your code does what you want it to do while also providing testing documentation.</p>
</section>
<section id="benefits-of-testing" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="benefits-of-testing"><span class="header-section-number">8.2</span> Benefits of testing</h2>
<p>While developing functions in R, programmers usually do informal testing. After you wrote the function, you most likely test it in the console by running it on the set of data and comparing the result with the expectation. This approach is good for informal testing while developing code, but it becomes problematic if you need to add new functionality to your code a month or two later and there is no record of the tests you performed. This makes it very easy to break code that used to work.</p>
<p>What about a more formal QC process? Once you have written R code, you might ask a colleague to independently QC the functions you have created to make sure are correct by testing them with a few examples. The approach is valid and gets the job done however, there are a few questions:</p>
<ul>
<li><p>How would you ensure the code performs as expected in cases when the human reviewer is not available?</p></li>
<li><p>How will you ensure that the changes you made to a different part of the code later on didn’t affect the code that was already QCed and tested?</p></li>
<li><p>How should the reviewer document the testing?</p></li>
</ul>
<p>All these questions can be addressed with <strong>automated testing</strong> (also known as automated <strong>unit testing</strong>). Unit testing allows us to check the correct behavior of a unit of code, which, in the context of R, translates to the correct behavior of a function.</p>
<p>Automated unit testing advantages:</p>
<ul>
<li><p>Saves time and effort, and helps with debugging.</p></li>
<li><p>Helps to ensure the code performs as expected in cases when the human reviewer is not available.</p></li>
<li><p>You can rerun your tests every time any part of the code changes to ensure that the new code didn’t affect previously set functionality and expectations.</p></li>
<li><p>The tests themselves provide documentation for the code.</p></li>
</ul>
<p>… <strong>and it forces you to write testable code</strong> thus improving the overall code design.</p>
</section>
<section id="writing-testable-code" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="writing-testable-code"><span class="header-section-number">8.3</span> Writing testable code</h2>
<p>If you are struggling to write tests, take it as a hint that the problem might lie in the design of your function(s). <strong>A good function has one main task that it performs</strong> that then is getting tested.</p>
<p>In the MiniProject7, we discussed that good functions should be easy to read, review, and improve. It is also easier to test and debug a function that has <strong>one main task it performs</strong>. Remember how in section <em><code>6. Review and refactor. Often.</code></em> of the MiniProject7 our function took a data location path and did everything from reading the SAS dataset to producing the table content? A function like this would be harder to test since it is performing two actions: reading the data in and wrangling it. In that exercise, we were able to simplify things after we updated the function to <strong><em>only</em></strong> produce the summarized counts using the data that was read in outside the function. This improved function’s speed and made it more suitable for testing.</p>
</section>
<section id="automated-testing-with-testthat" class="level2" data-number="8.4">
<h2 data-number="8.4" class="anchored" data-anchor-id="automated-testing-with-testthat"><span class="header-section-number">8.4</span> Automated testing with {testthat}</h2>
<p><strong>{testthat}</strong> is the most popular unit testing package for R and is primarily used for testing R packages, however you can use its neat functionality when developing your own code even if you don’t want to wrap it up in a package.</p>
</section>
<section id="expectations" class="level2" data-number="8.5">
<h2 data-number="8.5" class="anchored" data-anchor-id="expectations"><span class="header-section-number">8.5</span> Expectations</h2>
<p>An <strong>expectation</strong> is the finest level of testing and it allows us to assert that the values returned by a function match the ones we should get. It describes the expected result of a computation: Does it have the right value and right class? Does it produce an error when it should? An expectation automates visual checking of results in the console. Expectations are functions that start with <code>expect_</code>.</p>
<p>The developer should test valid inputs, invalid inputs, errors, exceptions, events, and everything that has a potential to break.</p>
<p>There are a <a href="https://testthat.r-lib.org/reference/index.html">great number of expectation functions</a> in the {testthat} package. The examples of questions they answer are:</p>
<ul>
<li><p>Does code return the expected value? <a href="https://testthat.r-lib.org/reference/equality-expectations.html"><code>expect_equal()</code></a> <a href="https://testthat.r-lib.org/reference/equality-expectations.html"><code>expect_identical()</code></a></p></li>
<li><p>Does code return a vector with the specified length? <a href="https://testthat.r-lib.org/reference/expect_length.html">expect_length()</a></p></li>
<li><p>Does code return a number greater/less than the expected value? <a href="https://testthat.r-lib.org/reference/comparison-expectations.html"><code>expect_lt()</code></a> <a href="https://testthat.r-lib.org/reference/comparison-expectations.html"><code>expect_lte()</code></a> <a href="https://testthat.r-lib.org/reference/comparison-expectations.html"><code>expect_gt()</code></a> <a href="https://testthat.r-lib.org/reference/comparison-expectations.html">expect_gte()</a></p></li>
<li><p>Does code return <code>TRUE</code> or <code>FALSE</code>? <a href="https://testthat.r-lib.org/reference/logical-expectations.html"><code>expect_true()</code></a> <a href="https://testthat.r-lib.org/reference/logical-expectations.html"><code>expect_false()</code></a></p></li>
<li><p>Does code throw an error, warning, message, or other condition? <a href="https://testthat.r-lib.org/reference/expect_error.html"><code>expect_error()</code></a> <a href="https://testthat.r-lib.org/reference/expect_error.html"><code>expect_warning()</code></a> <a href="https://testthat.r-lib.org/reference/expect_error.html"><code>expect_message()</code></a> <code>expect_condition()</code></p></li>
</ul>
<p>…and so many more!</p>
<p>Testing is <strong>a very broad topic</strong> and we won’t be able to cover everything in this mini-project. The main objective is to grasp the idea of testing and get familiar with the {testthat} package.</p>
</section>
<section id="writing-testable-code---example" class="level2" data-number="8.6">
<h2 data-number="8.6" class="anchored" data-anchor-id="writing-testable-code---example"><span class="header-section-number">8.6</span> Writing testable code - example</h2>
<p>Now that we discussed benefits of testing and learned about the {testthat} package, let’s take a look at few functions we are going to work with today. The first function we are going to test is <code>wrangle_data()</code> function. It takes one argument - data. Then, it loads, filters, and subsets the data using and returns <code>adsl_data</code> object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(testthat)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create wrangle_data function</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>wrangle_data <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  adsl_data <span class="ot">&lt;-</span> adsl_data <span class="sc">%&gt;%</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(SAFFL <span class="sc">==</span> <span class="st">"Y"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="st">"STUDYID"</span>, <span class="st">"USUBJID"</span>, <span class="st">"SEX"</span>, <span class="st">"TRT01A"</span>, <span class="st">"TRT01AN"</span>, <span class="st">"SAFFL"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(adsl_data)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, let’s take a look at the <code>adsl_counts()</code> function that we worked with in Mini Project 7 (its simplified version). This function will take the <strong>output</strong> of the <code>wrangle_data()</code> function and take it as <strong>input.</strong> Notice that the <code>adsl_counts</code> function is doing a few things:</p>
<ul>
<li><p>First it creates an object <code>Big_N_cnt</code> that holds total count of occurrences by treatment group</p></li>
<li><p>Then it creates an object <code>small_n_cnt</code> that holds total count of occurrences by treatment group and sex</p></li>
<li><p>And then it leverages <code>Big_N_cnt</code> and <code>small_n_cnt</code> to create <code>adsl_mrg_cnt</code> tibble that is using these two objects to calculate the percentage.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>adsl_counts <span class="ot">&lt;-</span> <span class="cf">function</span>(adsl_data) {</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  Big_N_cnt <span class="ot">&lt;-</span>  adsl_data   <span class="sc">%&gt;%</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>( TRT01AN, TRT01A  ) <span class="sc">%&gt;%</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(<span class="at">name =</span> <span class="st">"N"</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  Big_N_cnt</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  small_n_cnt <span class="ot">&lt;-</span>  adsl_data  <span class="sc">%&gt;%</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>( TRT01AN, TRT01A,  SEX ) <span class="sc">%&gt;%</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(<span class="at">name =</span> <span class="st">"n"</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  small_n_cnt</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  adsl_mrg_cnt <span class="ot">&lt;-</span> small_n_cnt <span class="sc">%&gt;%</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(Big_N_cnt, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"TRT01A"</span>, <span class="st">"TRT01AN"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">perc =</span> <span class="fu">round</span>((n<span class="sc">/</span>N)<span class="sc">*</span><span class="dv">100</span>, <span class="at">digits=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(TRT01A, SEX, perc)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  adsl_mrg_cnt</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Functions like this may be harder to debug and test because there are dependencies inside the function e.g.&nbsp;<code>adsl_mrg_cnt</code> step will fail if <code>small_n_cnt</code> or <code>Big_N_cnt</code> are not computed or produce unexpected result.</p>
<p>With that in mind, let’s break our big function into three smaller one so that we can test each one individually. We will call these functions <code>calculate_Big_N_cnt</code>, <code>calculate_small_n_cnt</code> , and <code>adsl_counts</code>.</p>
<p>First, we will create a function <code>calculate_Big_N_cnt</code> that takes in <code>adsl_data</code> argument and <code>returns</code> the <code>Big_N_cnt</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>calculate_Big_N_cnt <span class="ot">&lt;-</span> <span class="cf">function</span>(adsl_data) {</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  Big_N_cnt <span class="ot">&lt;-</span>  adsl_data   <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>( TRT01AN, TRT01A ) <span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(<span class="at">name =</span> <span class="st">"N"</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(Big_N_cnt)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now add some code to turn the lines of code below into the <code>calculate_small_n_cnt</code> function that takes in <code>adsl_data</code> argument. Remember to <code>return()</code> the <code>small_n_cnt.</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>calculate_small_n_cnt <span class="ot">&lt;-</span> <span class="cf">function</span>(adsl_data) {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  small_n_cnt <span class="ot">&lt;-</span> adsl_data <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(TRT01AN, TRT01A, SEX) <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(<span class="at">name =</span> <span class="st">"n"</span>, <span class="at">.groups =</span> <span class="st">'drop'</span>) <span class="co"># Added .groups = 'drop' for best practice</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(small_n_cnt)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And now let’s transform the code below into the <code>adsl_counts</code>function. Remember, this function will take the output of the two functions above as arguments.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>adsl_counts <span class="ot">&lt;-</span> <span class="cf">function</span>(small_n_cnt, Big_N_cnt) {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  adsl_mrg_cnt <span class="ot">&lt;-</span> small_n_cnt <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(Big_N_cnt, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"TRT01A"</span>, <span class="st">"TRT01AN"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">perc =</span> <span class="fu">round</span>((n<span class="sc">/</span>N)<span class="sc">*</span><span class="dv">100</span>, <span class="at">digits=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(TRT01A, SEX, perc)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(adsl_mrg_cnt)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="writing-tests" class="level2" data-number="8.7">
<h2 data-number="8.7" class="anchored" data-anchor-id="writing-tests"><span class="header-section-number">8.7</span> Writing tests</h2>
<p>Now let’s test our functions! We are going to use the <code>expect_</code> functions described above to assist us with testing. We are going to test the input, output data for our functions and confirm that the calculations that our functions perform are correct.</p>
<p>First, let’s write some tests for our <code>wrangle_data()</code> function. For our test data we are going to use the<br>
CDISC ADaM data published by PHUSE organization (<code>adsl_data</code> is already loaded into our environment). The rule of thumb is to use different data for testing than the data you are using to run the production code. The data should also be well controlled. In this case, the ADSL data format is standardized coming from a reliable source. The <code>wrangle_data()</code> function is doing a couple of transformations (it filters and subsets the data) and we want to test for unexpected <strong>output</strong>.</p>
<p>Certain tests will require us to create additional test data to test certain functionality, but we will discuss this once we get there.</p>
<p>Let’s take a look at the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Read in PHUSE data</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>phuse_data <span class="ot">&lt;-</span> rio<span class="sc">::</span><span class="fu">import</span>(<span class="st">"./data/adsl.xpt"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(phuse_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       STUDYID     USUBJID SUBJID SITEID SITEGR1                  ARM
1 CDISCPILOT01 01-701-1015   1015    701     701              Placebo
2 CDISCPILOT01 01-701-1023   1023    701     701              Placebo
3 CDISCPILOT01 01-701-1028   1028    701     701 Xanomeline High Dose
4 CDISCPILOT01 01-701-1033   1033    701     701  Xanomeline Low Dose
5 CDISCPILOT01 01-701-1034   1034    701     701 Xanomeline High Dose
6 CDISCPILOT01 01-701-1047   1047    701     701              Placebo
                TRT01P TRT01PN               TRT01A TRT01AN     TRTSDT
1              Placebo       0              Placebo       0 2014-01-02
2              Placebo       0              Placebo       0 2012-08-05
3 Xanomeline High Dose      81 Xanomeline High Dose      81 2013-07-19
4  Xanomeline Low Dose      54  Xanomeline Low Dose      54 2014-03-18
5 Xanomeline High Dose      81 Xanomeline High Dose      81 2014-07-01
6              Placebo       0              Placebo       0 2013-02-12
      TRTEDT TRTDUR AVGDD CUMDOSE AGE AGEGR1 AGEGR1N  AGEU  RACE RACEN SEX
1 2014-07-02    182   0.0       0  63    &lt;65       1 YEARS WHITE     1   F
2 2012-09-01     28   0.0       0  64    &lt;65       1 YEARS WHITE     1   M
3 2014-01-14    180  77.7   13986  71  65-80       2 YEARS WHITE     1   M
4 2014-03-31     14  54.0     756  74  65-80       2 YEARS WHITE     1   M
5 2014-12-30    183  76.9   14067  77  65-80       2 YEARS WHITE     1   F
6 2013-03-09     26   0.0       0  85    &gt;80       3 YEARS WHITE     1   F
                  ETHNIC SAFFL ITTFL EFFFL COMP8FL COMP16FL COMP24FL DISCONFL
1     HISPANIC OR LATINO     Y     Y     Y       Y        Y        Y         
2     HISPANIC OR LATINO     Y     Y     Y       N        N        N        Y
3 NOT HISPANIC OR LATINO     Y     Y     Y       Y        Y        Y         
4 NOT HISPANIC OR LATINO     Y     Y     Y       N        N        N        Y
5 NOT HISPANIC OR LATINO     Y     Y     Y       Y        Y        Y         
6 NOT HISPANIC OR LATINO     Y     Y     Y       N        N        N        Y
  DSRAEFL DTHFL BMIBL BMIBLGR1 HEIGHTBL WEIGHTBL EDUCLVL   DISONSDT DURDIS
1                25.1   25-&lt;30    147.3     54.4      16 2010-04-30   43.9
2       Y        30.4     &gt;=30    162.6     80.3      14 2006-03-11   76.4
3                31.4     &gt;=30    177.8     99.3      16 2009-12-16   42.8
4                28.8   25-&lt;30    175.3     88.5      12 2009-08-02   55.3
5                26.1   25-&lt;30    154.9     62.6       9 2011-09-29   32.9
6       Y        30.4     &gt;=30    148.6     67.1       8 2009-07-26   42.0
  DURDSGR1   VISIT1DT    RFSTDTC    RFENDTC VISNUMEN     RFENDT
1     &gt;=12 2013-12-26 2014-01-02 2014-07-02       12 2014-07-02
2     &gt;=12 2012-07-22 2012-08-05 2012-09-02        5 2012-09-02
3     &gt;=12 2013-07-11 2013-07-19 2014-01-14       12 2014-01-14
4     &gt;=12 2014-03-10 2014-03-18 2014-04-14        5 2014-04-14
5     &gt;=12 2014-06-24 2014-07-01 2014-12-30       12 2014-12-30
6     &gt;=12 2013-01-22 2013-02-12 2013-03-29        6 2013-03-29
                      DCDECOD         DCREASCD MMSETOT
1                   COMPLETED        Completed      23
2               ADVERSE EVENT    Adverse Event      23
3                   COMPLETED        Completed      23
4 STUDY TERMINATED BY SPONSOR Sponsor Decision      23
5                   COMPLETED        Completed      21
6               ADVERSE EVENT    Adverse Event      23</code></pre>
</div>
</div>
<p>Now let’s take a look at the function’s output when it is applied to the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create wrange data function</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>wrangle_data <span class="ot">&lt;-</span> <span class="cf">function</span>(adsl_data) {</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  adsl_data <span class="ot">&lt;-</span> adsl_data <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(SAFFL <span class="sc">==</span> <span class="st">"Y"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="st">"STUDYID"</span>, <span class="st">"USUBJID"</span>, <span class="st">"SEX"</span>, <span class="st">"TRT01A"</span>, <span class="st">"TRT01AN"</span>, <span class="st">"SAFFL"</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(adsl_data)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>adsl_data <span class="ot">&lt;-</span> <span class="fu">wrangle_data</span>(phuse_data) </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>adsl_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         STUDYID     USUBJID SEX               TRT01A TRT01AN SAFFL
1   CDISCPILOT01 01-701-1015   F              Placebo       0     Y
2   CDISCPILOT01 01-701-1023   M              Placebo       0     Y
3   CDISCPILOT01 01-701-1028   M Xanomeline High Dose      81     Y
4   CDISCPILOT01 01-701-1033   M  Xanomeline Low Dose      54     Y
5   CDISCPILOT01 01-701-1034   F Xanomeline High Dose      81     Y
6   CDISCPILOT01 01-701-1047   F              Placebo       0     Y
7   CDISCPILOT01 01-701-1097   M  Xanomeline Low Dose      54     Y
8   CDISCPILOT01 01-701-1111   F  Xanomeline Low Dose      54     Y
9   CDISCPILOT01 01-701-1115   M  Xanomeline Low Dose      54     Y
10  CDISCPILOT01 01-701-1118   M              Placebo       0     Y
11  CDISCPILOT01 01-701-1130   M              Placebo       0     Y
12  CDISCPILOT01 01-701-1133   F Xanomeline High Dose      81     Y
13  CDISCPILOT01 01-701-1146   F Xanomeline High Dose      81     Y
14  CDISCPILOT01 01-701-1148   M Xanomeline High Dose      81     Y
15  CDISCPILOT01 01-701-1153   F              Placebo       0     Y
16  CDISCPILOT01 01-701-1180   M Xanomeline High Dose      81     Y
17  CDISCPILOT01 01-701-1181   F Xanomeline High Dose      81     Y
18  CDISCPILOT01 01-701-1188   M  Xanomeline Low Dose      54     Y
19  CDISCPILOT01 01-701-1192   F  Xanomeline Low Dose      54     Y
20  CDISCPILOT01 01-701-1203   F              Placebo       0     Y
21  CDISCPILOT01 01-701-1211   F  Xanomeline Low Dose      54     Y
22  CDISCPILOT01 01-701-1234   M              Placebo       0     Y
23  CDISCPILOT01 01-701-1239   M Xanomeline High Dose      81     Y
24  CDISCPILOT01 01-701-1275   M Xanomeline High Dose      81     Y
25  CDISCPILOT01 01-701-1287   F Xanomeline High Dose      81     Y
26  CDISCPILOT01 01-701-1294   M  Xanomeline Low Dose      54     Y
27  CDISCPILOT01 01-701-1302   M Xanomeline High Dose      81     Y
28  CDISCPILOT01 01-701-1317   M  Xanomeline Low Dose      54     Y
29  CDISCPILOT01 01-701-1324   M  Xanomeline Low Dose      54     Y
30  CDISCPILOT01 01-701-1341   M  Xanomeline Low Dose      54     Y
31  CDISCPILOT01 01-701-1345   F              Placebo       0     Y
32  CDISCPILOT01 01-701-1360   M Xanomeline High Dose      81     Y
33  CDISCPILOT01 01-701-1363   F              Placebo       0     Y
34  CDISCPILOT01 01-701-1383   F Xanomeline High Dose      81     Y
35  CDISCPILOT01 01-701-1387   F              Placebo       0     Y
36  CDISCPILOT01 01-701-1392   M              Placebo       0     Y
37  CDISCPILOT01 01-701-1415   M              Placebo       0     Y
38  CDISCPILOT01 01-701-1429   F  Xanomeline Low Dose      54     Y
39  CDISCPILOT01 01-701-1440   M              Placebo       0     Y
40  CDISCPILOT01 01-701-1442   F  Xanomeline Low Dose      54     Y
41  CDISCPILOT01 01-701-1444   M Xanomeline High Dose      81     Y
42  CDISCPILOT01 01-702-1082   F  Xanomeline Low Dose      54     Y
43  CDISCPILOT01 01-703-1042   M              Placebo       0     Y
44  CDISCPILOT01 01-703-1076   M Xanomeline High Dose      81     Y
45  CDISCPILOT01 01-703-1086   M  Xanomeline Low Dose      54     Y
46  CDISCPILOT01 01-703-1096   F              Placebo       0     Y
47  CDISCPILOT01 01-703-1100   F              Placebo       0     Y
48  CDISCPILOT01 01-703-1119   F  Xanomeline Low Dose      54     Y
49  CDISCPILOT01 01-703-1175   M              Placebo       0     Y
50  CDISCPILOT01 01-703-1182   M  Xanomeline Low Dose      54     Y
51  CDISCPILOT01 01-703-1197   F  Xanomeline Low Dose      54     Y
52  CDISCPILOT01 01-703-1210   F              Placebo       0     Y
53  CDISCPILOT01 01-703-1258   F Xanomeline High Dose      81     Y
54  CDISCPILOT01 01-703-1279   F  Xanomeline Low Dose      54     Y
55  CDISCPILOT01 01-703-1295   F Xanomeline High Dose      81     Y
56  CDISCPILOT01 01-703-1299   F              Placebo       0     Y
57  CDISCPILOT01 01-703-1335   F Xanomeline High Dose      81     Y
58  CDISCPILOT01 01-703-1379   F  Xanomeline Low Dose      54     Y
59  CDISCPILOT01 01-703-1403   M Xanomeline High Dose      81     Y
60  CDISCPILOT01 01-703-1439   F Xanomeline High Dose      81     Y
61  CDISCPILOT01 01-704-1008   F Xanomeline High Dose      81     Y
62  CDISCPILOT01 01-704-1009   M  Xanomeline Low Dose      54     Y
63  CDISCPILOT01 01-704-1010   M              Placebo       0     Y
64  CDISCPILOT01 01-704-1017   M Xanomeline High Dose      81     Y
65  CDISCPILOT01 01-704-1025   F  Xanomeline Low Dose      54     Y
66  CDISCPILOT01 01-704-1065   M Xanomeline High Dose      81     Y
67  CDISCPILOT01 01-704-1074   F Xanomeline High Dose      81     Y
68  CDISCPILOT01 01-704-1093   M Xanomeline High Dose      81     Y
69  CDISCPILOT01 01-704-1114   M  Xanomeline Low Dose      54     Y
70  CDISCPILOT01 01-704-1120   F  Xanomeline Low Dose      54     Y
71  CDISCPILOT01 01-704-1127   F              Placebo       0     Y
72  CDISCPILOT01 01-704-1135   F  Xanomeline Low Dose      54     Y
73  CDISCPILOT01 01-704-1164   F              Placebo       0     Y
74  CDISCPILOT01 01-704-1218   F  Xanomeline Low Dose      54     Y
75  CDISCPILOT01 01-704-1233   F              Placebo       0     Y
76  CDISCPILOT01 01-704-1241   M Xanomeline High Dose      81     Y
77  CDISCPILOT01 01-704-1260   F              Placebo       0     Y
78  CDISCPILOT01 01-704-1266   M Xanomeline High Dose      81     Y
79  CDISCPILOT01 01-704-1323   F  Xanomeline Low Dose      54     Y
80  CDISCPILOT01 01-704-1325   M  Xanomeline Low Dose      54     Y
81  CDISCPILOT01 01-704-1332   M Xanomeline High Dose      81     Y
82  CDISCPILOT01 01-704-1351   M              Placebo       0     Y
83  CDISCPILOT01 01-704-1388   M              Placebo       0     Y
84  CDISCPILOT01 01-704-1435   M              Placebo       0     Y
85  CDISCPILOT01 01-704-1445   M              Placebo       0     Y
86  CDISCPILOT01 01-705-1018   F              Placebo       0     Y
87  CDISCPILOT01 01-705-1031   F  Xanomeline Low Dose      54     Y
88  CDISCPILOT01 01-705-1059   F              Placebo       0     Y
89  CDISCPILOT01 01-705-1186   F              Placebo       0     Y
90  CDISCPILOT01 01-705-1199   M  Xanomeline Low Dose      54     Y
91  CDISCPILOT01 01-705-1280   F Xanomeline High Dose      81     Y
92  CDISCPILOT01 01-705-1281   F Xanomeline High Dose      81     Y
93  CDISCPILOT01 01-705-1282   F              Placebo       0     Y
94  CDISCPILOT01 01-705-1292   F  Xanomeline Low Dose      54     Y
95  CDISCPILOT01 01-705-1303   M Xanomeline High Dose      81     Y
96  CDISCPILOT01 01-705-1310   F Xanomeline High Dose      81     Y
97  CDISCPILOT01 01-705-1349   F              Placebo       0     Y
98  CDISCPILOT01 01-705-1377   F Xanomeline High Dose      81     Y
99  CDISCPILOT01 01-705-1382   M Xanomeline High Dose      81     Y
100 CDISCPILOT01 01-705-1393   F  Xanomeline Low Dose      54     Y
101 CDISCPILOT01 01-705-1431   F  Xanomeline Low Dose      54     Y
102 CDISCPILOT01 01-706-1041   F              Placebo       0     Y
103 CDISCPILOT01 01-706-1049   F Xanomeline High Dose      81     Y
104 CDISCPILOT01 01-706-1384   F  Xanomeline Low Dose      54     Y
105 CDISCPILOT01 01-707-1037   F  Xanomeline Low Dose      54     Y
106 CDISCPILOT01 01-707-1206   M              Placebo       0     Y
107 CDISCPILOT01 01-708-1019   M  Xanomeline Low Dose      54     Y
108 CDISCPILOT01 01-708-1032   M  Xanomeline Low Dose      54     Y
109 CDISCPILOT01 01-708-1084   F  Xanomeline Low Dose      54     Y
110 CDISCPILOT01 01-708-1087   F              Placebo       0     Y
111 CDISCPILOT01 01-708-1158   F              Placebo       0     Y
112 CDISCPILOT01 01-708-1171   F              Placebo       0     Y
113 CDISCPILOT01 01-708-1178   F Xanomeline High Dose      81     Y
114 CDISCPILOT01 01-708-1213   F Xanomeline High Dose      81     Y
115 CDISCPILOT01 01-708-1216   M Xanomeline High Dose      81     Y
116 CDISCPILOT01 01-708-1236   F Xanomeline High Dose      81     Y
117 CDISCPILOT01 01-708-1253   M              Placebo       0     Y
118 CDISCPILOT01 01-708-1272   M  Xanomeline Low Dose      54     Y
119 CDISCPILOT01 01-708-1286   F              Placebo       0     Y
120 CDISCPILOT01 01-708-1296   M              Placebo       0     Y
121 CDISCPILOT01 01-708-1297   M  Xanomeline Low Dose      54     Y
122 CDISCPILOT01 01-708-1316   F              Placebo       0     Y
123 CDISCPILOT01 01-708-1336   M Xanomeline High Dose      81     Y
124 CDISCPILOT01 01-708-1342   F              Placebo       0     Y
125 CDISCPILOT01 01-708-1347   F Xanomeline High Dose      81     Y
126 CDISCPILOT01 01-708-1348   F  Xanomeline Low Dose      54     Y
127 CDISCPILOT01 01-708-1353   F  Xanomeline Low Dose      54     Y
128 CDISCPILOT01 01-708-1372   M Xanomeline High Dose      81     Y
129 CDISCPILOT01 01-708-1378   M              Placebo       0     Y
130 CDISCPILOT01 01-708-1406   F Xanomeline High Dose      81     Y
131 CDISCPILOT01 01-708-1428   F  Xanomeline Low Dose      54     Y
132 CDISCPILOT01 01-709-1001   F              Placebo       0     Y
133 CDISCPILOT01 01-709-1007   F  Xanomeline Low Dose      54     Y
134 CDISCPILOT01 01-709-1020   F  Xanomeline Low Dose      54     Y
135 CDISCPILOT01 01-709-1029   M Xanomeline High Dose      81     Y
136 CDISCPILOT01 01-709-1081   F  Xanomeline Low Dose      54     Y
137 CDISCPILOT01 01-709-1088   M              Placebo       0     Y
138 CDISCPILOT01 01-709-1099   F Xanomeline High Dose      81     Y
139 CDISCPILOT01 01-709-1102   F  Xanomeline Low Dose      54     Y
140 CDISCPILOT01 01-709-1168   F Xanomeline High Dose      81     Y
141 CDISCPILOT01 01-709-1217   M  Xanomeline Low Dose      54     Y
142 CDISCPILOT01 01-709-1238   M Xanomeline High Dose      81     Y
143 CDISCPILOT01 01-709-1259   M              Placebo       0     Y
144 CDISCPILOT01 01-709-1285   M  Xanomeline Low Dose      54     Y
145 CDISCPILOT01 01-709-1301   F              Placebo       0     Y
146 CDISCPILOT01 01-709-1306   F              Placebo       0     Y
147 CDISCPILOT01 01-709-1309   M Xanomeline High Dose      81     Y
148 CDISCPILOT01 01-709-1312   F              Placebo       0     Y
149 CDISCPILOT01 01-709-1326   F  Xanomeline Low Dose      54     Y
150 CDISCPILOT01 01-709-1329   M Xanomeline High Dose      81     Y
151 CDISCPILOT01 01-709-1339   M              Placebo       0     Y
152 CDISCPILOT01 01-709-1424   M Xanomeline High Dose      81     Y
153 CDISCPILOT01 01-710-1002   M  Xanomeline Low Dose      54     Y
154 CDISCPILOT01 01-710-1006   M Xanomeline High Dose      81     Y
155 CDISCPILOT01 01-710-1021   M Xanomeline High Dose      81     Y
156 CDISCPILOT01 01-710-1027   M              Placebo       0     Y
157 CDISCPILOT01 01-710-1045   F  Xanomeline Low Dose      54     Y
158 CDISCPILOT01 01-710-1053   F  Xanomeline Low Dose      54     Y
159 CDISCPILOT01 01-710-1060   M              Placebo       0     Y
160 CDISCPILOT01 01-710-1070   F Xanomeline High Dose      81     Y
161 CDISCPILOT01 01-710-1077   F              Placebo       0     Y
162 CDISCPILOT01 01-710-1078   F              Placebo       0     Y
163 CDISCPILOT01 01-710-1083   F              Placebo       0     Y
164 CDISCPILOT01 01-710-1137   F Xanomeline High Dose      81     Y
165 CDISCPILOT01 01-710-1142   F Xanomeline High Dose      81     Y
166 CDISCPILOT01 01-710-1154   M  Xanomeline Low Dose      54     Y
167 CDISCPILOT01 01-710-1166   F  Xanomeline Low Dose      54     Y
168 CDISCPILOT01 01-710-1183   F              Placebo       0     Y
169 CDISCPILOT01 01-710-1187   F Xanomeline High Dose      81     Y
170 CDISCPILOT01 01-710-1235   F  Xanomeline Low Dose      54     Y
171 CDISCPILOT01 01-710-1249   M Xanomeline High Dose      81     Y
172 CDISCPILOT01 01-710-1264   M              Placebo       0     Y
173 CDISCPILOT01 01-710-1270   F  Xanomeline Low Dose      54     Y
174 CDISCPILOT01 01-710-1271   F              Placebo       0     Y
175 CDISCPILOT01 01-710-1278   M Xanomeline High Dose      81     Y
176 CDISCPILOT01 01-710-1300   F  Xanomeline Low Dose      54     Y
177 CDISCPILOT01 01-710-1314   F              Placebo       0     Y
178 CDISCPILOT01 01-710-1315   F              Placebo       0     Y
179 CDISCPILOT01 01-710-1354   M Xanomeline High Dose      81     Y
180 CDISCPILOT01 01-710-1358   M  Xanomeline Low Dose      54     Y
181 CDISCPILOT01 01-710-1368   F              Placebo       0     Y
182 CDISCPILOT01 01-710-1385   M  Xanomeline Low Dose      54     Y
183 CDISCPILOT01 01-710-1408   M Xanomeline High Dose      81     Y
184 CDISCPILOT01 01-711-1012   F Xanomeline High Dose      81     Y
185 CDISCPILOT01 01-711-1036   M              Placebo       0     Y
186 CDISCPILOT01 01-711-1143   F  Xanomeline Low Dose      54     Y
187 CDISCPILOT01 01-711-1433   F Xanomeline High Dose      81     Y
188 CDISCPILOT01 01-713-1043   F  Xanomeline Low Dose      54     Y
189 CDISCPILOT01 01-713-1073   F  Xanomeline Low Dose      54     Y
190 CDISCPILOT01 01-713-1106   M Xanomeline High Dose      81     Y
191 CDISCPILOT01 01-713-1141   M Xanomeline High Dose      81     Y
192 CDISCPILOT01 01-713-1179   F              Placebo       0     Y
193 CDISCPILOT01 01-713-1209   F Xanomeline High Dose      81     Y
194 CDISCPILOT01 01-713-1256   M              Placebo       0     Y
195 CDISCPILOT01 01-713-1269   M              Placebo       0     Y
196 CDISCPILOT01 01-713-1448   F  Xanomeline Low Dose      54     Y
197 CDISCPILOT01 01-714-1035   F              Placebo       0     Y
198 CDISCPILOT01 01-714-1068   F  Xanomeline Low Dose      54     Y
199 CDISCPILOT01 01-714-1195   M  Xanomeline Low Dose      54     Y
200 CDISCPILOT01 01-714-1288   M Xanomeline High Dose      81     Y
201 CDISCPILOT01 01-714-1375   F              Placebo       0     Y
202 CDISCPILOT01 01-714-1425   M Xanomeline High Dose      81     Y
203 CDISCPILOT01 01-715-1085   F  Xanomeline Low Dose      54     Y
204 CDISCPILOT01 01-715-1107   M  Xanomeline Low Dose      54     Y
205 CDISCPILOT01 01-715-1155   F              Placebo       0     Y
206 CDISCPILOT01 01-715-1207   F              Placebo       0     Y
207 CDISCPILOT01 01-715-1319   M Xanomeline High Dose      81     Y
208 CDISCPILOT01 01-715-1321   F Xanomeline High Dose      81     Y
209 CDISCPILOT01 01-715-1397   F              Placebo       0     Y
210 CDISCPILOT01 01-715-1405   M  Xanomeline Low Dose      54     Y
211 CDISCPILOT01 01-716-1024   F              Placebo       0     Y
212 CDISCPILOT01 01-716-1026   F              Placebo       0     Y
213 CDISCPILOT01 01-716-1030   F Xanomeline High Dose      81     Y
214 CDISCPILOT01 01-716-1044   M              Placebo       0     Y
215 CDISCPILOT01 01-716-1063   M  Xanomeline Low Dose      54     Y
216 CDISCPILOT01 01-716-1071   F Xanomeline High Dose      81     Y
217 CDISCPILOT01 01-716-1094   M  Xanomeline Low Dose      54     Y
218 CDISCPILOT01 01-716-1103   M  Xanomeline Low Dose      54     Y
219 CDISCPILOT01 01-716-1108   F              Placebo       0     Y
220 CDISCPILOT01 01-716-1151   F  Xanomeline Low Dose      54     Y
221 CDISCPILOT01 01-716-1157   M  Xanomeline Low Dose      54     Y
222 CDISCPILOT01 01-716-1160   F              Placebo       0     Y
223 CDISCPILOT01 01-716-1167   M  Xanomeline Low Dose      54     Y
224 CDISCPILOT01 01-716-1177   M              Placebo       0     Y
225 CDISCPILOT01 01-716-1189   M Xanomeline High Dose      81     Y
226 CDISCPILOT01 01-716-1229   F Xanomeline High Dose      81     Y
227 CDISCPILOT01 01-716-1298   F  Xanomeline Low Dose      54     Y
228 CDISCPILOT01 01-716-1308   F              Placebo       0     Y
229 CDISCPILOT01 01-716-1311   M  Xanomeline Low Dose      54     Y
230 CDISCPILOT01 01-716-1364   F Xanomeline High Dose      81     Y
231 CDISCPILOT01 01-716-1373   M Xanomeline High Dose      81     Y
232 CDISCPILOT01 01-716-1418   F Xanomeline High Dose      81     Y
233 CDISCPILOT01 01-716-1441   M              Placebo       0     Y
234 CDISCPILOT01 01-716-1447   F Xanomeline High Dose      81     Y
235 CDISCPILOT01 01-717-1004   F  Xanomeline Low Dose      54     Y
236 CDISCPILOT01 01-717-1109   M Xanomeline High Dose      81     Y
237 CDISCPILOT01 01-717-1174   M Xanomeline High Dose      81     Y
238 CDISCPILOT01 01-717-1201   F              Placebo       0     Y
239 CDISCPILOT01 01-717-1344   F              Placebo       0     Y
240 CDISCPILOT01 01-717-1357   M Xanomeline High Dose      81     Y
241 CDISCPILOT01 01-717-1446   F  Xanomeline Low Dose      54     Y
242 CDISCPILOT01 01-718-1066   F  Xanomeline Low Dose      54     Y
243 CDISCPILOT01 01-718-1079   F  Xanomeline Low Dose      54     Y
244 CDISCPILOT01 01-718-1101   M Xanomeline High Dose      81     Y
245 CDISCPILOT01 01-718-1139   M              Placebo       0     Y
246 CDISCPILOT01 01-718-1150   F              Placebo       0     Y
247 CDISCPILOT01 01-718-1170   F  Xanomeline Low Dose      54     Y
248 CDISCPILOT01 01-718-1172   M              Placebo       0     Y
249 CDISCPILOT01 01-718-1250   F  Xanomeline Low Dose      54     Y
250 CDISCPILOT01 01-718-1254   M  Xanomeline Low Dose      54     Y
251 CDISCPILOT01 01-718-1328   M Xanomeline High Dose      81     Y
252 CDISCPILOT01 01-718-1355   M              Placebo       0     Y
253 CDISCPILOT01 01-718-1371   F Xanomeline High Dose      81     Y
254 CDISCPILOT01 01-718-1427   F Xanomeline High Dose      81     Y</code></pre>
</div>
</div>
<p>We expect that the <strong>output</strong> of <code>wrangle_data()</code> will have total of six columns and the <code>"SAFFL"</code> column will only contain <code>"Y"</code> values since this is what we are filtering on.</p>
<p>We will use <a href="https://testthat.r-lib.org/reference/equality-expectations.html"><code>expect_equal()</code></a> test to confirm that the returned <code>SAFFL</code> column only contains <code>Y</code> values and that there are no <code>NA</code> values present in that column. The <code>expect_equal(object, expected)</code> function takes two arguments: <em>object</em> (computation)<em>, expected</em> (value to compare it to).</p>
<p>In the first test, we are using the <code>unique()</code> function to determine a unique values in the <code>adsl_data$SAFFL</code> column which we expect to be <code>Y</code> hence the second argument of the <code>expect_equal()</code> function.</p>
<p>Notice that running the <code>expect_equal()</code> test below does not give you the output and that’s expected in cases when you run individual tests that pass. You’d get the output if your test produces the error or if you group several expectations that test a function or a feature.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign wrangle_data() output to the adsl_data object</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>adsl_data <span class="ot">&lt;-</span> <span class="fu">wrangle_data</span>(phuse_data)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a test</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">expect_equal</span>(<span class="fu">unique</span>(adsl_data<span class="sc">$</span>SAFFL), <span class="st">"Y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the second test below, we are using <code>is.na</code> and <code>sum</code> functions to confirm that there are no missing values in the <code>adsl_data$SAFFL</code> column. We learned from the <em>MiniProject8 - applying functions</em> that with the help of <code>is.na</code> function R evaluates whether the values in the SAFFL variable are missing, creating <code>TRUE</code> or <code>FALSE</code> for every observation simultaneously. Then we’re taking the sum of those values where <code>TRUE</code> = 1 and <code>FALSE</code> = 0. This gives the number of missing values in the column which in our case we expect to be 0.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">expect_equal</span>(<span class="fu">sum</span>(<span class="fu">is.na</span>(adsl_data<span class="sc">$</span>SAFFL)), <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s also create a test for the expectation that our output data set should only contain 6 columns <a href="https://testthat.r-lib.org/reference/expect_length.html"><code>expect_length()</code></a> .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">expect_length</span>(<span class="fu">names</span>(adsl_data), <span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>{test_that}</strong> allows us to group several expectations that test a function or a feature. In order to group the expectations, we need to use <code>test_that(desc, code)</code> shown below to name each expectation. The naming will allow us to identify any failing test more easily.</p>
<p>Run the code below, look at the error and fix it accordingly. Notice how user-friendly the error is!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"wrangle_data() output is correct"</span>, {</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  adsl_data <span class="ot">&lt;-</span> <span class="fu">wrangle_data</span>(adsl_data)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_success</span>(<span class="fu">expect_equal</span>(<span class="fu">unique</span>(adsl_data<span class="sc">$</span>SAFFL), <span class="st">"Y"</span>))</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_success</span>(<span class="fu">expect_equal</span>(<span class="fu">sum</span>(<span class="fu">is.na</span>(adsl_data<span class="sc">$</span>SAFFL)), <span class="dv">0</span>))</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_success</span>(<span class="fu">expect_length</span>(<span class="fu">names</span>(adsl_data), <span class="dv">5</span>))</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If the function is performing correctly we expect all three tests to succeed so we can also wrap each test up into <a href="https://testthat.r-lib.org/reference/expect_success.html"><code>expect_success()</code></a> function. We can also use <code>expect_failure()</code> functions to test our expectations and catch errors. We expect <code>expect_equal()</code> below to fail if there are “N” values in the output data SAFFL column.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">expect_failure</span>(<span class="fu">expect_equal</span>(<span class="fu">unique</span>(adsl_data<span class="sc">$</span>SAFFL), <span class="st">"N"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We also have to remember that the <strong>output</strong> of the <code>wrangle_data()</code> function will become an <strong>input</strong> for the <code>calculate_Big_N_cnt()</code> and <code>calculate_small_n_cnt()</code> and it is important to ensure that <strong>input</strong> data for these functions will meet the expectations otherwise the whole pipeline will break.</p>
<p>Now let’s create a test to confirm that the <code>wrangle_data()</code> <strong>output</strong> (<code>adsl_data</code> object) which is going to be an <strong><em>input</em></strong> for the <code>calculate_Big_N_cnt()</code> and <code>calculate_small_n_cnt()</code>functions contains expected column names as these functions expect certain columns to be present in the data. To help us test that, let’s create a vector with expected names called <code>expected_vars</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>expected_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"TRT01AN"</span>, <span class="st">"TRT01A"</span>, <span class="st">"SEX"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can check if “TRT01AN” “TRT01A”, and “SEX” column names are present in the data using the <code>%in%</code> operator. The code below compares two vectors: the <code>expected_vars</code> we created above and the vector of the column names in the <code>adsl_data</code> output. R is evaluating whether the values in the <code>expected_vars</code> variable are present in the <code>names(adsl_data)</code>, creating <code>TRUE</code> or <code>FALSE</code> for every observation in <code>expected_vars</code>. As we learned above and from <em>MiniProject8</em>, we can take the sum of those values where <code>TRUE</code> = 1 and <code>FALSE</code> = 0.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(expected_vars <span class="sc">%in%</span> <span class="fu">names</span>(adsl_data))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When running the code, we received a value of <code>3</code> which is what we would expect if all three columns are present in the data. Now, let’s use the <code>expect_equal()</code> function to write the test. Complete the test code below setting the expectation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"expected columns are all present in the wrangle_data() output"</span>, {</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>( , )</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now that we created tests to check the inputs and outputs of the <code>wrangle_data()</code> function, let’s take a look at testing the <code>calculate_Big_N_cnt()</code> and <code>calculate_small_n_cnt()</code> functions.</p>
<p>So far, we’ve been using test PHUSE data set to facilitate testing expectations specific to ADSL data e.g column names or certain expectations that could be easily verified. However, you might not have reliable test data available on hand or the one you have might not be easy to use to test certain expectations. It is very common to create your own test data, especially if you need to test particular computations.</p>
<p>For testing <code>calculate_Big_N_cnt()</code> and <code>calculate_small_n_cnt()</code> functions we will create our own test data that mimics <code>adsl_data</code> output, but easier to manage.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a> <span class="sc">~</span>STUDYID,  <span class="sc">~</span>TRT01AN,   <span class="sc">~</span>TRT01A,       <span class="sc">~</span>SEX,    <span class="sc">~</span>SAFFL, <span class="sc">~</span>USUBJID,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a> <span class="st">"CDISCPILOT01"</span>,    <span class="dv">1</span>,     <span class="st">"Treatment A"</span>,  <span class="st">'Female'</span>,  <span class="st">"Y"</span>,   <span class="st">"01-701-1015"</span>, </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a> <span class="st">"CDISCPILOT01"</span>,    <span class="dv">1</span>,     <span class="st">"Treatment A"</span>,  <span class="st">'Male'</span>,    <span class="st">"Y"</span>,   <span class="st">"01-701-1023"</span>,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a> <span class="st">"CDISCPILOT01"</span>,    <span class="dv">2</span>,     <span class="st">"Treatment B"</span>,  <span class="st">'Female'</span>,  <span class="st">"Y"</span>,   <span class="st">"01-701-1180"</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a> <span class="st">"CDISCPILOT01"</span>,    <span class="dv">1</span>,     <span class="st">"Treatment A"</span>,  <span class="st">'Male'</span>,    <span class="st">"Y"</span>,   <span class="st">"01-701-1138"</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a> <span class="st">"CDISCPILOT01"</span>,    <span class="dv">1</span>,     <span class="st">"Treatment A"</span>,  <span class="st">'Female'</span>,  <span class="st">"Y"</span>,   <span class="st">"01-702-1145"</span>,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a> <span class="st">"CDISCPILOT01"</span>,    <span class="dv">2</span>,     <span class="st">"Treatment B"</span>,  <span class="st">'Male'</span>,    <span class="st">"Y"</span>,   <span class="st">"01-702-1180"</span>,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a> <span class="st">"CDISCPILOT01"</span>,    <span class="dv">2</span>,     <span class="st">"Treatment B"</span>,  <span class="st">'Female'</span>,  <span class="st">"Y"</span>,   <span class="st">"01-703-1558"</span>,</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a> <span class="st">"CDISCPILOT01"</span>,    <span class="dv">1</span>,     <span class="st">"Treatment A"</span>,  <span class="st">'Male'</span>,    <span class="st">"Y"</span>,   <span class="st">"01-703-1678"</span>,</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="fu">view</span>(test_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>calculate_Big_N_cnt()</code> function creates <code>Big_N_cnt</code> tibble <strong><em>output</em></strong> that is expected to <strong>only</strong> have three columns: <code>"TRT01AN"</code>, <code>"TRT01A"</code>, and <code>"N"</code>. In this case we can use the <a href="https://testthat.r-lib.org/reference/expect_named.html"><code>expect_named()</code></a> function that will match the exact number of columns and their names in the object to the expected character vector.</p>
<p>Note that in the test example above we created a named vector and in this example below we used an unnamed vector to store the expected names. These both are valid approaches. The rule of thumb is if you are going to reuse the same vector repeatedly, it is better to store it as a separate object and if you are going to reuse it across multiple test files, store it in a separate file. We will discuss this more in detail down below in the <strong><em>Organize and run your tests</em></strong> section.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"expected columns are all present in the calculate_Big_N_cnt() output"</span>, {</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">expect_named</span>(<span class="fu">calculate_Big_N_cnt</span>(test_data), <span class="fu">c</span>(<span class="st">"TRT01AN"</span>, <span class="st">"TRT01A"</span>, <span class="st">"N"</span>))</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test passed 🎊</code></pre>
</div>
</div>
<p>What else do we expect for the <code>calculate_Big_N_cnt()</code><strong>output</strong> data? We know exactly what dimensions it should have. It should always have three columns and the number of rows corresponding to the number of treatment groups. We can set this expectation using <code>expect_equal(object, expected)</code> function.</p>
<p>For the first <code>object</code> argument of <code>expect_equal()</code> we are going to use <code>dim()</code>. The <code>dim()</code> function gives us a vector of two numbers (number of rows and number of columns in the <code>calculate_Big_N_cnt()</code> output object).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(<span class="fu">calculate_Big_N_cnt</span>(test_data))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2 3</code></pre>
</div>
</div>
<p>For the second <code>expected</code> argument of <code>expect_equal()</code>we are going to use a vector of two values:</p>
<p>The first value is the number of rows corresponding to the number of treatment groups in the output data set. We will use <code>unique()</code> function to determine a unique number of treatment groups and <code>length()</code> to count the groups. Using these functions instead of hardcoding the number of rows will ensure that our test code will work for any other test data if needed, not only the one we are working with right now.</p>
<p>The second value can be hard-coded since we will always expect 3 columns in the output dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">calculate_Big_N_cnt</span>(test_data)<span class="sc">$</span>TRT01A)), <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2 3</code></pre>
</div>
</div>
<p>Now we are ready to combine these two arguments together into the test <code>expect_equal()</code> test:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"calculate_Big_N_cnt() output has expected dim, columns, and types"</span>, {</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">dim</span>(<span class="fu">calculate_Big_N_cnt</span>(test_data)), <span class="fu">c</span>(<span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">calculate_Big_N_cnt</span>(test_data)<span class="sc">$</span>TRT01A)), <span class="dv">3</span>))</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test passed 🥇</code></pre>
</div>
</div>
<p>Let’s not forget about the <code>calculate_small_n_cnt</code> function that we created earlier and set some expectations for the data <strong>outputs</strong> for that function as well. Complete the functions below to have correct expectations for the <code>small_n_cnt</code> output that is returned by the function. Remember, the <code>small_n_cnt</code> object returns more columns and rows than its <code>Big_N_cnt</code> counterpart. You’ll also get twice as many rows since treatment groups are divided by sex as well.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"calculate_small_n_cnt() output has expected dim, columns, and types"</span>, {</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">expect_named</span>( , )</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">expect_equal</span>( , )</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now let’s gather all tests we created so far and put them all together. Remember, we can combine all relevant tests together and update the test_that description accordingly. Add your <code>calculate_small_n_cnt</code> set of tests here as well.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"wrangle_data() output has expected dimentions and values"</span>, {</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_success</span>(<span class="fu">expect_equal</span>(<span class="fu">unique</span>(adsl_data<span class="sc">$</span>SAFFL), <span class="st">"Y"</span>))</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_success</span>(<span class="fu">expect_equal</span>(<span class="fu">sum</span>(<span class="fu">is.na</span>(adsl_data<span class="sc">$</span>SAFFL)), <span class="dv">0</span>))</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_success</span>(<span class="fu">expect_length</span>(<span class="fu">names</span>(adsl_data), <span class="dv">6</span>))</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">sum</span>(expected_vars <span class="sc">%in%</span> <span class="fu">names</span>(adsl_data)), <span class="dv">3</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"calculate_Big_N_cnt() output has expected dim, columns, and types"</span>, {</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  test_Big_N_cnt <span class="ot">&lt;-</span> <span class="fu">calculate_Big_N_cnt</span>(test_data)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_named</span>(test_Big_N_cnt, <span class="fu">c</span>(<span class="st">"TRT01AN"</span>, <span class="st">"TRT01A"</span>, <span class="st">"N"</span>))</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">dim</span>(test_Big_N_cnt), <span class="fu">c</span>(<span class="fu">length</span>(<span class="fu">unique</span>(test_Big_N_cnt<span class="sc">$</span>TRT01A)), <span class="dv">3</span>))</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_type</span>(test_Big_N_cnt<span class="sc">$</span>N, <span class="st">"integer"</span>)</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Did you notice that the second set of tests has the <a href="https://testthat.r-lib.org/reference/inheritance-expectations.html"><code>expect_type()</code></a> that we didn’t go cover earlier? This function is pretty self-explanatory and it is a very helpful and important function to know if your code depends on the particular input/output data types that come in and come out of the function.</p>
<p>Now, let’s talk about setting expectations for <code>calculate_small_n_cnt()</code> and <code>calculate_Big_N_cnt()</code> <strong>computations</strong> since we need to create tests to check if the values in the <code>small_n_cnt</code> and <code>Big_N_cnt</code> outputs are calculated as expected. For that, we will again use our <code>test_data</code> since it will be very easy to check if the computations are performed correctly on a smaller set of data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(test_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  STUDYID      TRT01AN TRT01A      SEX    SAFFL USUBJID    
  &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;      
1 CDISCPILOT01       1 Treatment A Female Y     01-701-1015
2 CDISCPILOT01       1 Treatment A Male   Y     01-701-1023
3 CDISCPILOT01       2 Treatment B Female Y     01-701-1180
4 CDISCPILOT01       1 Treatment A Male   Y     01-701-1138
5 CDISCPILOT01       1 Treatment A Female Y     01-702-1145
6 CDISCPILOT01       2 Treatment B Male   Y     01-702-1180</code></pre>
</div>
</div>
<p><code>calculate_Big_N_cnt()</code> counts a number of occurrences per Treatment group so looking at the <code>test_data</code>, we can easily determine that we should get N=5 for “Treatment A” and N=3 for “Treatment B” when we apply <code>calculate_Big_N_cnt()</code> <strong>IF</strong> our function works as expected. Let’s write a test and see if out function passes the test.</p>
<p>We first will apply the function to a test data and assign it to an object <code>test_Big_N_cnt</code> and then use <code>expect_equal</code> function to see if our assumption is correct.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"calculate_Big_N_cnt() produces correct calculation"</span>, {</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>test_Big_N_cnt <span class="ot">&lt;-</span> <span class="fu">calculate_Big_N_cnt</span>(test_data)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">expect_equal</span>(test_Big_N_cnt<span class="sc">$</span>N, <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">3</span>))</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test passed 🌈</code></pre>
</div>
</div>
<p>Let’s test the same expectation for the <code>calculate_small_n_cnt()</code> taking into account that it counts occurrences per treatment per group. Note, R sorts alphabetically by default unless specified otherwise.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"calculate_small_n_cnt() produces correct calculation"</span>, {</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>test_small_n_cnt <span class="ot">&lt;-</span> <span class="fu">calculate_small_n_cnt</span>(test_data)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">expect_equal</span>(<span class="fu">head</span>(test_small_n_cnt<span class="sc">$</span>n, <span class="dv">2</span>), <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>))</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test passed 🥇</code></pre>
</div>
</div>
<p>We also expect that when we make a sum of small n values by sex per treatment they will have the same values as the big N so let’s write the test. Let’s take a look at the <code>test_small_n_cnt</code> (the <code>calculate_small_n_cnt(test_data)</code> output) to remind us of its structure.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>test_small_n_cnt <span class="ot">&lt;-</span> <span class="fu">calculate_small_n_cnt</span>(test_data)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>test_small_n_cnt  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 5
# Groups:   TRT01AN, TRT01A, SEX [4]
  TRT01AN TRT01A      SEX    .groups     n
    &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;  &lt;chr&gt;   &lt;int&gt;
1       1 Treatment A Female drop        2
2       1 Treatment A Male   drop        3
3       2 Treatment B Female drop        2
4       2 Treatment B Male   drop        1</code></pre>
</div>
</div>
<p>In order to calculate the sum of <code>n</code> values by sex per treatment, we can use the <code>aggregate()</code> function. The <code>aggregate()</code> function in R splits the data into subsets, computes specified summary statistics for each subset, and returns the result in a group by form. In the console below type <code>?aggregate</code> and take a look at the description of the <code>x</code>, <code>by</code>, and <code>FUN</code> arguments we are using below. We will need to assign the result of the <code>aggregate()</code> function to a new <code>aggregate_small_n_cnt</code> variable that we are going to use in the test.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>aggregate_small_n_cnt <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(<span class="at">x =</span> test_small_n_cnt<span class="sc">$</span>n, <span class="at">by=</span><span class="fu">list</span>(<span class="at">TRT01A=</span>test_small_n_cnt<span class="sc">$</span>TRT01A), <span class="at">FUN=</span>sum)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>aggregate_small_n_cnt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       TRT01A x
1 Treatment A 5
2 Treatment B 3</code></pre>
</div>
</div>
<p><code>aggregate()</code> is a base R function that fits great for this purpose however, we could use <code>group_by()</code> and <code>summarize()</code> functions from the {<a href="https://dplyr.tidyverse.org/index.html">dplyr</a>} package as an alternative to get the same result. Run the code below to confirm that it produces the same result as the output of the <code>aggregate()</code> function. It is important to note that there are multiple ways to approach the same task in R. Numerous R packages, base R functions, and a combination of both provides a wide range of solutions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>aggregate_small_n_cnt <span class="ot">&lt;-</span> test_small_n_cnt <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(TRT01A) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">x =</span> <span class="fu">sum</span>(n))</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>aggregate_small_n_cnt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  TRT01A          x
  &lt;chr&gt;       &lt;int&gt;
1 Treatment A     5
2 Treatment B     3</code></pre>
</div>
</div>
<p>Now we have a new <code>aggregate_small_n_cnt</code> object with column <code>x</code> that we expect to contain the same values that column <code>N</code> of the <code>calculate_Big_N_cnt(test_data)</code> output contains. Let’s check if our results are identical. For that we will use the <code>expect_identical</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"big n and summarized small n are identical"</span>, {</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  aggregate_small_n_cnt <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> test_small_n_cnt<span class="sc">$</span>n, </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">by=</span><span class="fu">list</span>(<span class="at">TRT01A=</span>test_small_n_cnt<span class="sc">$</span>TRT01A), </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">FUN=</span>sum)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  test_Big_N_cnt <span class="ot">&lt;-</span> <span class="fu">calculate_Big_N_cnt</span>(test_data)</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_identical</span>(aggregate_small_n_cnt<span class="sc">$</span>x, test_Big_N_cnt<span class="sc">$</span>N)</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>})  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test passed 🥇</code></pre>
</div>
</div>
<p>Great! Now we accounted for quite a few situations that could go wrong and it will be easier for us to debug the code as the tests will tell us exactly where the error lies if certain tests don’t pass.</p>
<p>Remember, <strong>we only scratched the surface of testing</strong> your data and there are so many more cases, packages, tutorials, and great examples out there! Here are just a few:</p>
<ul>
<li><p><a href="https://r-pkgs.org/testing-basics.html">R Packages: Testing Basics</a></p></li>
<li><p><a href="https://journal.r-project.org/archive/2011-1/RJournal_2011-1_Wickham.pdf">testthat: Get Started with Testing</a></p></li>
<li><p><a href="https://www.pipinghotdata.com/posts/2021-11-23-getting-started-with-unit-testing-in-r/">Getting started with unit testing in R</a></p></li>
<li><p><a href="https://www.rstudio.com/conference/2022/talks/shinytest2-unit-testing-for-shiny/">{shinytest2}: Unit testing for Shiny applications</a></p></li>
<li><p><a href="https://www.r-bloggers.com/2019/11/automated-testing-with-testthat-in-practice/" class="uri">https://www.r-bloggers.com/2019/11/automated-testing-with-testthat-in-practice/</a></p></li>
<li><p><a href="https://covr.r-lib.org/">Test Coverage for Packages • covr</a></p></li>
</ul>
</section>
<section id="organize-and-run-your-tests" class="level2" data-number="8.8">
<h2 data-number="8.8" class="anchored" data-anchor-id="organize-and-run-your-tests"><span class="header-section-number">8.8</span> Organize and run your tests</h2>
<p><strong>{testthat}</strong> works best within the package workflow as you get some of the setup benefits “for free”, however you don’t have to create a package to utilize {testthat}, but there are a few rules you need to follow to make your testing experience seamless.</p>
<p>Your folder structure should look like this:</p>
<p><img src="img/folder_structure.png" class="img-fluid"></p>
<p>You should keep your all your R scripts organized in folder named <code>R</code>, and all your tests in <code>test/testthat</code> folder. Note that testthat tests <strong>must</strong> live in files below <code>tests/testthat/</code> and these file names <strong>must</strong> begin with <code>test</code>. The test file name is displayed in testthat output, which provides helpful context.</p>
<p>When downloading (cloning) this MiniProject12, you also downloaded (cloned) the <em>MiniProject12_Example</em> folder along with it. Inside the <em>MiniProject12_Example</em> folder, you’ll find the example of how the testing structure should be set up. You can browse the folder and check out the files structure and contents. The folder also contains the <em>Example.Rproj</em>. If you double-click on the project, it will open a new R session with preconfigured directory settings that will allow you to run the tests. Once you opened the <em>MiniProject12_Example.Rproj</em>, go to the <code>tests/testthat/testthat.R</code> and run the script. You’ll see the test details in the console. Once you finished exploring, go to the upper right corner of the RStudio IDE and click “Close Project”.</p>
<p><img src="img/close_project.png" class="img-fluid"></p>
</section>
<section id="challenge" class="level2" data-number="8.9">
<h2 data-number="8.9" class="anchored" data-anchor-id="challenge"><span class="header-section-number">8.9</span> Challenge</h2>
<p>We still have <code>adsl_counts()</code> that we need to test! Explore the function and create tests to test if the <code>perc</code> values calculated correctly. Think of other data transformations that happen within the function and write tests to catch unexpected inputs/outputs, errors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create calculate_Big_N_cnt function</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>calculate_Big_N_cnt <span class="ot">&lt;-</span> <span class="cf">function</span>(adsl_data) {</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  Big_N_cnt <span class="ot">&lt;-</span>  adsl_data   <span class="sc">%&gt;%</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>( TRT01AN, TRT01A ) <span class="sc">%&gt;%</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(<span class="at">name =</span> <span class="st">"N"</span>)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(Big_N_cnt)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create calculate_small_n_cnt function</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>calculate_small_n_cnt <span class="ot">&lt;-</span> <span class="cf">function</span>(adsl_data) {</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>  small_n_cnt <span class="ot">&lt;-</span>  adsl_data  <span class="sc">%&gt;%</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>( TRT01AN, TRT01A,  SEX ) <span class="sc">%&gt;%</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(<span class="at">name =</span> <span class="st">"n"</span>)</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(small_n_cnt)</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Create adsl_counts function </span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>adsl_counts <span class="ot">&lt;-</span> <span class="cf">function</span>(adsl_data, Big_N_cnt, small_n_cnt) {</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>  adsl_mrg_cnt <span class="ot">&lt;-</span> small_n_cnt <span class="sc">%&gt;%</span></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(Big_N_cnt, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"TRT01A"</span>, <span class="st">"TRT01AN"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">perc =</span> <span class="fu">round</span>((n<span class="sc">/</span>N)<span class="sc">*</span><span class="dv">100</span>, <span class="at">digits=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">SEX =</span> <span class="fu">recode</span>(SEX, </span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"M"</span> <span class="ot">=</span> <span class="st">"Male"</span>,</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"F"</span> <span class="ot">=</span> <span class="st">"Female"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(TRT01A, SEX, perc)</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(adsl_mrg_cnt)</span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the result</span></span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a>Big_N_cnt <span class="ot">&lt;-</span> <span class="fu">calculate_Big_N_cnt</span>(test_data)</span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a>small_n_cnt <span class="ot">&lt;-</span> <span class="fu">calculate_small_n_cnt</span>(test_data)</span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply adsl_counts() function </span></span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a>adsl_test_data <span class="ot">&lt;-</span>  test_data <span class="sc">%&gt;%</span> </span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adsl_counts</span>(., Big_N_cnt, small_n_cnt)</span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a>adsl_test_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  TRT01A      SEX     perc
  &lt;chr&gt;       &lt;chr&gt;  &lt;dbl&gt;
1 Treatment A Female  40  
2 Treatment A Male    60  
3 Treatment B Female  66.7
4 Treatment B Male    33.3</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co"> Create test cases for adsl_counts()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./MiniProject11.html" class="pagination-link" aria-label="Mini-project 11 - Tidy evaluation">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Mini-project 11 - Tidy evaluation</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./MiniProject13.html" class="pagination-link" aria-label="Mini-project13 - Code style">
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Mini-project13 - Code style</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>